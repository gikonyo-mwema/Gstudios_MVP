"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6271],{67211:function(e,t,a){var n=a(52322),s=a(84605);t.Z=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-muted border-opacity-50 bg-gray-300 p-3",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)(s.Z,{size:20,strokeWidth:1.5}),(0,n.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},37397:function(e,t,a){var n=a(52322),s=a(95492),r=a(70847);t.Z=()=>(0,n.jsxs)(s.bZ,{variant:"default",children:[(0,n.jsx)(r.aN,{}),(0,n.jsx)(s.X,{children:"Database backups do not include objects stored via the Storage API, as the database only includes metadata about these objects. Restoring an old backup does not restore objects that have been deleted since then."})]})},66020:function(e,t,a){a.d(t,{Z:function(){return q}});var n=a(52322),s=a(59491),r=a(39097),l=a.n(r),i=a(2784),o=a(62202),c=a(20085),d=a(32830),u=a(84447),m=a(22854),x=a(81076),h=a(74138),p=a(27570),f=a(85945),j=a(48228),v=a(31696),b=a(24368);async function g(e){let{projectRef:t,connectionString:a,id:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:r,error:l}=await (0,v.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},headers:s});return l&&(0,v.S3)(l),r}let y=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,f.NL)();return(0,j.D)(e=>g(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(b.o.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?o.Am.error("Failed to disable database extension: ".concat(e.message)):t(e,a,n)},...a})};var N=a(14528),w=a(17172),_=a(41679),S=a(22238),C=a(49650),Z=a(18592),k=a(47852),z=a(62277),E=a(750),I=a(62284),T=a(31654),R=a(82796),F=a(95492),A=a(78804),D=a(32079),P=e=>{let{visible:t,extension:a,onCancel:s}=e,{project:r}=(0,p.d2)(),[l,c]=(0,i.useState)(),[d,u]=(0,i.useState)(!1),{data:m,isLoading:x}=(0,C.Q)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),{mutate:h,isLoading:f}=(0,S.k)({onSuccess:()=>{o.ZP.success("".concat(a.name," is on.")),s()},onError:e=>{o.ZP.error("Failed to enable ".concat(a.name,": ").concat(e.message))}});(0,i.useEffect)(()=>{let e=!1;return t&&(async()=>{e||(u(!0),c(void 0));try{let t=await (0,Z.Rj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(a.name,"'")});e||c(t.result[0].schema)}catch(e){}u(!1)})(),()=>{e=!0}},[t,a.name]);let j=async e=>{if(void 0===r)return console.error("Project is required");let t=null!=l?l:"custom"===e.schema?e.name:e.schema;h({projectRef:r.ref,connectionString:null==r?void 0:r.connectionString,schema:t,name:a.name,version:a.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,n.jsx)(k.C,{hideFooter:!0,visible:t,onCancel:s,size:"small",header:(0,n.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,n.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,n.jsx)("code",{className:"text-xs",children:a.name})]}),children:(0,n.jsx)(z.Z,{initialValues:{name:a.name,schema:"extensions"},validate:e=>{let t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:j,children:e=>{let{values:t}=e;return(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsx)(k.C.Content,{children:d||x?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(_.Z,{}),(0,n.jsx)("div",{className:"w-3/4",children:(0,n.jsx)(_.Z,{})})]}):l?(0,n.jsx)(E.Z,{disabled:!0,id:"schema",name:"schema",value:l,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(l,".")}):(0,n.jsxs)(I.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,n.jsxs)(I.Z.Option,{id:"custom",label:'Create a new schema "'.concat(a.name,'"'),value:"custom",addOnBefore:()=>(0,n.jsx)(T.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',a.name,'"']},"custom"),(0,n.jsx)(k.C.Separator,{}),null==m?void 0:m.map(e=>(0,n.jsx)(I.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,n.jsx)(R.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})}),"custom"===t.schema&&(0,n.jsx)(k.C.Content,{children:(0,n.jsx)(E.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===a.name&&(null==r?void 0:r.cloud_provider)==="FLY"&&(0,n.jsx)(k.C.Content,{children:(0,n.jsxs)(F.bZ,{variant:"warning",children:[(0,n.jsx)(A.Z,{strokeWidth:2}),(0,n.jsx)(F.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,n.jsx)(F.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,n.jsx)(F.X,{className:"mt-3",children:(0,n.jsx)(D.z,{asChild:!0,type:"default",iconRight:(0,n.jsx)(w.Z,{width:12,height:12}),children:(0,n.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,n.jsx)("span",{children:"Learn more"})})})})]})}),(0,n.jsx)(k.C.Separator,{}),(0,n.jsx)(k.C.Content,{children:(0,n.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,n.jsx)(D.z,{type:"default",disabled:f,onClick:()=>s(),children:"Cancel"}),(0,n.jsx)(D.z,{htmlType:"submit",disabled:f,loading:f,children:"Enable extension"})]})})]})}})})},q=e=>{var t,a,r,f,j;let{extension:v}=e,{project:b}=(0,p.d2)(),g=null!==v.installed_version,[w,_]=(0,i.useState)(!1),{mutate:S,isLoading:C}=y({onSuccess:()=>{o.ZP.success("".concat(v.name," is off.")),E(!1)}}),Z=(0,N.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"extensions");async function k(){return _(!0)}let[z,E]=(0,i.useState)(!1),I=()=>{if(void 0===b)return console.error("Project is required");S({projectRef:b.ref,connectionString:b.connectionString,id:v.name})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,n.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 max-w-[85%]",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 truncate",children:[(0,n.jsx)("h3",{title:v.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:v.name}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:null!==(f=null==v?void 0:v.installed_version)&&void 0!==f?f:v.default_version})]}),c.Rw.find(e=>e.name===v.name)?(0,n.jsx)(l(),{href:(null===(t=c.Rw.find(e=>e.name===v.name))||void 0===t?void 0:t.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null===(a=c.Rw.find(e=>e.name===v.name))||void 0===a?void 0:a.link):null!==(j=null===(r=c.Rw.find(e=>e.name===v.name))||void 0===r?void 0:r.link)&&void 0!==j?j:"",className:"max-w-[85%] cursor-default zans",target:"_blank",rel:"noreferrer",children:(0,n.jsx)(d.Z,{className:"ml-2.5 cursor-pointer",size:14})}):null]}),C?(0,n.jsx)(u.Z,{className:"animate-spin",size:16}):(0,n.jsx)(m.Z,{size:"tiny",checked:g,disabled:!Z,onChange:()=>g?void E(!0):k()})]}),(0,n.jsxs)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:[(0,n.jsx)("div",{className:"py-3 px-4",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:v.comment})}),g&&v.schema&&(0,n.jsx)("div",{className:"py-3 px-4",children:(0,n.jsxs)("div",{className:"flex items-center flex-grow space-x-2 text-sm text-foreground-light",children:[(0,n.jsx)("span",{children:"Schema:"}),(0,n.jsx)(x.C,{children:"".concat(v.schema)})]})})]})]}),(0,n.jsx)(P,{visible:w,extension:v,onCancel:()=>_(!1)}),(0,n.jsx)(h.Z,{visible:z,title:"Confirm to disable extension",confirmLabel:"Disable",confirmLabelLoading:"Disabling",onCancel:()=>E(!1),onConfirm:()=>I(),children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',v.name,'" extension?']})})]})}},87062:function(e,t,a){a.d(t,{QI:function(){return l},cK:function(){return r}});var n=a(45455),s=a.n(n);function r(e){let t=null==e?void 0:e.split(",");return s()(e)||!t||(null==t?void 0:t.length)==0?{value:[]}:{value:t.map(t=>{let a=t.trim().split(" ");return 2===a.length?{name:a[0],type:a[1]}:1===a.length?{name:a[0],type:a[0]}:void console.error("Error while trying to parse function arguments",e)}).filter(Boolean)}}function l(e){let t=[];if(e)for(var a in e)t.push({name:a,value:e[a]});return{value:t}}},52093:function(e,t,a){a.d(t,{I:function(){return s},_:function(){return r}});var n=a(99248);let s={STRIPE:"stripe_fdw_handler",FIREBASE:"firebase_fdw_handler",S3:"s3_fdw_handler",CLICK_HOUSE:"click_house_fdw_handler",BIG_QUERY:"big_query_fdw_handler",AIRTABLE:"airtable_fdw_handler",LOGFLARE:"logflare_fdw_handler",AUTH0:"auth0_fdw_handler",COGNITO:"cognito_fdw_handler",MSSQL:"mssql_fdw_handler",REDIS:"redis_fdw_handler"},r=[{name:"stripe_wrapper",handlerName:s.STRIPE,validatorName:"stripe_fdw_validator",icon:"".concat(n.GW,"/img/icons/stripe-icon.svg"),extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,hidden:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Accounts",description:"List of accounts on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"business_type",type:"text"},{name:"country",type:"text"},{name:"email",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"accounts",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0,type:"text"}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0,type:"text"}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0,type:"text"}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0,type:"text"}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0,type:"text"}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"firebase_wrapper",handlerName:s.FIREBASE,validatorName:"firebase_fdw_validator",icon:"".concat(n.GW,"/img/icons/firebase-icon.svg"),extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]}]},{name:"s3_wrapper",handlerName:s.S3,validatorName:"s3_fdw_validator",icon:"".concat(n.GW,"/img/icons/s3-icon.svg"),extensionName:"S3Fdw",label:"S3",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/s3",server:{options:[{name:"vault_access_key_id",label:"Access Key ID",required:!0,encrypted:!0,hidden:!0},{name:"vault_secret_access_key",label:"Access Key Secret",required:!0,encrypted:!0,hidden:!0},{name:"aws_region",label:"AWS Region",required:!0,encrypted:!1,hidden:!1,defaultValue:"us-east-1"}]},tables:[{label:"S3 File",description:"Map to a file in S3 (CSV or JSON only)",options:[{name:"uri",label:"URI",editable:!0,required:!0,placeholder:"s3://bucket/s3_table.csv",type:"text"},{name:"format",label:"Format",editable:!0,required:!0,type:"select",defaultValue:"csv",options:[{label:"CSV",value:"csv"},{label:"JSONL (JSON Lines)",value:"jsonl"}]},{name:"has_header",label:"Has Header",editable:!0,required:!0,type:"select",defaultValue:"true",options:[{label:"True",value:"true"},{label:"False",value:"false"}]},{name:"compress",label:"Compression",editable:!0,required:!1,type:"select",options:[{label:"GZIP",value:"gzip"}]}]}]},{name:"clickhouse_wrapper",handlerName:s.CLICK_HOUSE,validatorName:"click_house_fdw_validator",icon:"".concat(n.GW,"/img/icons/clickhouse-icon.svg"),extensionName:"ClickHouseFdw",label:"ClickHouse",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/clickhouse",server:{options:[{name:"conn_string_id",label:"ClickHouse Connection String",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"ClickHouse Table",description:"Map to a ClickHouse Table",options:[{name:"table",label:"ClickHouse Table Name",editable:!0,required:!0,placeholder:"my_clickhouse_table",type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"bigquery_wrapper",handlerName:s.BIG_QUERY,validatorName:"big_query_fdw_validator",icon:"".concat(n.GW,"/img/icons/bigquery-icon.svg"),extensionName:"BigQueryFdw",label:"BigQuery",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/bigquery",server:{options:[{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0},{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"dataset_id",label:"Dataset ID",required:!0,encrypted:!1,hidden:!1}]},tables:[{label:"BigQuery Table",description:"Map to a BigQuery Table",options:[{name:"table",label:"BigQuery Table Name",editable:!0,required:!0,placeholder:"my_bigquery_table",type:"text"},{name:"location",label:"Location",defaultValue:"US",editable:!0,required:!1,type:"text"},{name:"timeout",label:"Timeout (ms)",defaultValue:"30000",editable:!0,required:!1,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!1,type:"text"}]}]},{name:"airtable_wrapper",handlerName:s.AIRTABLE,validatorName:"airtable_fdw_validator",icon:"".concat(n.GW,"/img/icons/airtable-icon.svg"),extensionName:"airtableFdw",label:"Airtable",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/airtable",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Airtable Table",description:"Map to an Airtable Table",options:[{name:"base_id",label:"Base ID",editable:!0,required:!0,type:"text"},{name:"table_id",label:"Table ID",editable:!0,required:!0,type:"text"}]}]},{name:"logflare_wrapper",handlerName:s.LOGFLARE,validatorName:"logflare_fdw_validator",icon:"".concat(n.GW,"/img/icons/logflare-icon.svg"),extensionName:"logflareFdw",label:"Logflare",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/logflare",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Logflare Table",description:"Map to a Logflare Table",options:[{name:"endpoint",label:"Endpoint",editable:!0,required:!0,type:"text"}]}]},{name:"auth0_wrapper",handlerName:s.AUTH0,validatorName:"auth0_fdw_validator",icon:"".concat(n.GW,"/img/icons/auth0-icon.svg"),extensionName:"Auth0Fdw",label:"Auth0",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/auth0",minimumExtensionVersion:"0.3.0",server:{options:[{name:"api_key_id",label:"Auth0 API key or PAT",required:!0,encrypted:!0,hidden:!0},{name:"url",label:"Auth0 API URL",defaultValue:"https://dev-<tenant-id>.us.auth0.com/api/v2/users",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Users",description:"Auth0 Users",availableColumns:[{name:"user_id",type:"text"},{name:"email",type:"text"},{name:"email_verified",type:"boolean"},{name:"username",type:"text"},{name:"phone_number",type:"text"},{name:"phone_verified",type:"boolean"},{name:"created_at",type:"jsonb"},{name:"updated_at",type:"jsonb"},{name:"identities",type:"jsonb"},{name:"app_metadata",type:"jsonb"},{name:"user_metadata",type:"jsonb"},{name:"picture",type:"text"},{name:"name",type:"text"},{name:"nickname",type:"text"},{name:"multifactor",type:"jsonb"},{name:"last_ip",type:"text"},{name:"last_login",type:"jsonb"},{name:"logins_count",type:"integer"},{name:"blocked",type:"boolean"},{name:"given_name",type:"text"},{name:"family_name",type:"text"}],options:[{name:"object",defaultValue:"users",editable:!1,required:!0,type:"text"}]}]},{name:"cognito_wrapper",handlerName:s.COGNITO,validatorName:"cognito_fdw_validator",icon:"".concat(n.GW,"/img/icons/cognito-icon.svg"),extensionName:"CognitoFdw",label:"Cognito",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/cognito",minimumExtensionVersion:"0.3.0",server:{options:[{name:"aws_access_key_id",label:"AWS Access Key ID",required:!0,encrypted:!1,hidden:!1},{name:"api_key_id",label:"AWS Secret Key",required:!0,encrypted:!0,hidden:!0},{name:"region",label:"Region",required:!0,encrypted:!1,hidden:!1},{name:"user_pool_id",label:"User Pool ID",required:!0,encrypted:!1,hidden:!1}]},tables:[{label:"Users",description:"Cognito Users",availableColumns:[{name:"email",type:"text"},{name:"created_at",type:"text"},{name:"email_verified",type:"boolean"},{name:"identities",type:"jsonb"},{name:"username",type:"text"},{name:"status",type:"text"}],options:[{name:"object",defaultValue:"users",editable:!1,required:!0,type:"text"}]}]},{name:"mssql_wrapper",handlerName:s.MSSQL,validatorName:"mssql_fdw_validator",icon:"".concat(n.GW,"/img/icons/mssql-icon.svg"),extensionName:"mssqlFdw",label:"Microsoft SQL Server",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/mssql",minimumExtensionVersion:"0.3.0",server:{options:[{name:"conn_string_id",label:"Connection String",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Microsoft SQL Server Table",description:"Map to an Microsoft SQL Server Table",options:[{name:"table",label:"MSSQL Table",editable:!0,required:!0,type:"text"}]}]},{name:"redis_wrapper",handlerName:s.REDIS,validatorName:"redis_fdw_validator",icon:"".concat(n.GW,"/img/icons/redis-icon.svg"),extensionName:"redisFdw",label:"Redis",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/redis",minimumExtensionVersion:"0.3.0",server:{options:[{name:"conn_url_id",label:"Connection URL",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Redis Table",description:"Map to an Redis Table",options:[{name:"src_type",label:"Source Type",editable:!0,required:!0,type:"select",defaultValue:"list",options:[{label:"list",value:"list"},{label:"set",value:"set"},{label:"hash",value:"hash"},{label:"zset",value:"zset"},{label:"stream",value:"stream"},{label:"multi_list",value:"multi_list"},{label:"multi_set",value:"multi_set"},{label:"multi_hash",value:"multi_hash"},{label:"multi_zset",value:"multi_zset"}]},{name:"src_key",label:"Source Key",editable:!0,required:!1,type:"text"}]}]}]},90609:function(e,t,a){var n=a(52322),s=a(24990),r=a(59491),l=a(38421),i=a.n(l),o=a(39097),c=a.n(o),d=a(2784),u=a(99959),m=a(14528),x=a(32079),h=a(31654),p=a(34503),f=a(52093);t.Z=e=>{let{buttonText:t="Add wrapper",align:a="end"}=e,{ref:l}=(0,u.UO)();return(0,m.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers")?(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{asChild:!0,children:(0,n.jsx)(x.z,{type:"primary",icon:(0,n.jsx)(h.Z,{strokeWidth:1.5}),children:t})}),(0,n.jsx)(p.AW,{side:"bottom",align:a,children:f._.map((e,t)=>(0,n.jsxs)(d.Fragment,{children:[(0,n.jsx)(p.Xi,{className:"space-x-2",asChild:!0,children:(0,n.jsxs)(c(),{href:"/project/".concat(l,"/database/wrappers/new?type=").concat(e.name.toLowerCase()),children:[(0,n.jsx)(i(),{src:e.icon,width:20,height:20,alt:"".concat(e.name," wrapper icon")}),(0,n.jsx)("p",{children:e.label})]})},e.name),t!==f._.length-1&&(0,n.jsx)(p.VD,{})]},t))})]}):(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(x.z,{disabled:!0,type:"primary",icon:(0,n.jsx)(h.Z,{strokeWidth:1.5}),children:t})}),(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})}},46271:function(e,t,a){a.d(t,{M4:function(){return t6},TH:function(){return z},B8:function(){return nu},RA:function(){return aL},ZY:function(){return tu},ZR:function(){return nb},eX:function(){return aG},_h:function(){return tN},Ms:function(){return nq},IP:function(){return eU},Vj:function(){return tL},_y:function(){return tO},yT:function(){return eR},bw:function(){return Y},Hm:function(){return tA}});var n=a(52322),s=a(24990),r=a(59491),l=a(34291),i=a.n(l),o=a(39097),c=a.n(o),d=a(2784),u=a(32079),m=a(750),x=a(89682),h=a(31654),p=a(34503),f=a(23056),j=a(74559),v=a(62134),b=a(99959),g=a(41543),y=a(15735),N=a(56006),w=a(41679),_=a(14528),S=a(26541),C=a(11354),Z=a(78645),k=a(31362),z=e=>{var t,a,l,o,z;let{onAddColumn:E=i(),onEditColumn:I=i(),onDeleteColumn:T=i()}=e,{id:R,ref:F}=(0,b.UO)(),[A,D]=(0,d.useState)(""),{data:P,error:q,isError:L,isLoading:V,isSuccess:W}=(0,S.Z)(Number(R)),O=null!==(l=0===A.length?null!==(a=null==P?void 0:P.columns)&&void 0!==a?a:[]:null==P?void 0:null===(t=P.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(A)))&&void 0!==l?l:[],Y=C.F.includes(null!==(o=null==P?void 0:P.schema)&&void 0!==o?o:""),U=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(u.z,{asChild:!0,type:"outline",icon:(0,n.jsx)(Z.Z,{size:14}),style:{padding:"5px"},children:(0,n.jsx)(c(),{href:"/project/".concat(F,"/database/tables")})}),(0,n.jsx)(m.Z,{size:"small",placeholder:"Filter columns",value:A,onChange:e=>D(e.target.value),icon:(0,n.jsx)(x.Z,{size:"tiny"})})]}),!Y&&(0,n.jsx)("div",{children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{disabled:!U,icon:(0,n.jsx)(h.Z,{}),onClick:()=>E(),children:"New column"})}),!U&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create columns"})})]})})]})})]}),Y&&(0,n.jsx)(k.Z,{schema:null!==(z=null==P?void 0:P.schema)&&void 0!==z?z:"",entity:"columns"}),V&&(0,n.jsx)(w.A,{}),L&&(0,n.jsx)(N.Z,{error:q,subject:'Failed to retrieve columns for table "'.concat(null==P?void 0:P.schema,".").concat(null==P?void 0:P.name,'"')}),W&&(0,n.jsx)(n.Fragment,{children:0===O.length?(0,n.jsx)(g.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Data Type"},"type"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Format"},"format"),(0,n.jsx)(y.Z.th,{},"buttons")],body:O.map((e,t)=>(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(y.Z.td,{className:"break-all whitespace-normal",children:null!==e.comment?(0,n.jsx)("p",{title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(y.Z.td,{children:(0,n.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,n.jsx)(y.Z.td,{className:"font-mono text-xs",children:(0,n.jsx)("code",{className:"text-xs",children:e.format})}),(0,n.jsx)(y.Z.td,{className:"text-right",children:!Y&&(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(f.Z,{})})}),(0,n.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsx)(p.Xi,{disabled:!U,onClick:()=>I(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"Edit column"})]}),!U&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,n.jsx)(p.Xi,{disabled:!U||Y,onClick:()=>T(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(v.Z,{stroke:"red",size:"tiny"}),(0,n.jsx)("p",{children:"Delete column"})]}),!U&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name))})})})]})},E=a(96795),I=a.n(E),T=a(94941),R=a(5632),F=a(27570),A=a(92286),D=a(60028),P=a(49650),q=a(57924),L=a(53475),V=a(90488),W=a(61373),O=a(26815),Y=e=>{let{onAddTable:t=i(),onEditTable:a=i(),onDeleteTable:l=i()}=e,o=(0,R.useRouter)(),{ref:g}=(0,b.UO)(),{project:S}=(0,F.d2)(),Z=(0,L._2)(),[z,E]=(0,d.useState)(""),Y=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:U}=(0,P.Q)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString}),[B]=I()(null!=U?U:[],e=>{var t;return C.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),{data:M,isLoading:Q,isSuccess:H,isError:X,error:K}=(0,q.Bj)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:Z.selectedSchemaName,sortByProperty:"name",includeColumns:!0},{select:e=>0===z.length?e:e.filter(e=>e.name.includes(z))}),{data:G}=(0,D.z)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString}),J=(null!=G?G:[]).find(e=>"supabase_realtime"===e.name),$=null==U?void 0:U.find(e=>e.name===Z.selectedSchemaName),ee=B.some(e=>e.id===(null==$?void 0:$.id));return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(A.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:Z.selectedSchemaName,onSelectSchema:Z.setSelectedSchemaName}),(0,n.jsx)(m.Z,{size:"small",className:"w-64",placeholder:"Search for a table",value:z,onChange:e=>E(e.target.value),icon:(0,n.jsx)(x.Z,{size:"tiny"})})]}),!ee&&(0,n.jsx)("div",{children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{disabled:!Y,icon:(0,n.jsx)(h.Z,{}),onClick:()=>t(),children:"New table"})}),!Y&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create tables"})})]})})]})})]}),ee&&(0,n.jsx)(k.Z,{schema:Z.selectedSchemaName,entity:"tables"}),Q&&(0,n.jsx)(w.A,{}),X&&(0,n.jsx)(N.Z,{error:K,subject:"Failed to retrieve tables"}),H&&(0,n.jsx)("div",{className:"my-4 w-full",children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,n.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,n.jsx)(y.Z.th,{},"buttons")],body:(0,n.jsxs)(n.Fragment,{children:[0===M.length&&0===z.length&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:6,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no tables found in the schema "',Z.selectedSchemaName,'"']})]})},Z.selectedSchemaName),0===M.length&&z.length>0&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:6,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',z,'" did not return any results']})]})},Z.selectedSchemaName),M.length>0&&M.map((e,t)=>{var r,i,d;return(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{children:e.name.length>20?(0,n.jsxs)(s.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,n.jsx)(s.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(y.Z.td,{className:"hidden lg:table-cell ",children:null!==e.comment?(0,n.jsx)("span",{className:"lg:max-w-48 truncate inline-block",title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(null!==(i=e.live_rows_estimate)&&void 0!==i?i:e.live_row_count).toLocaleString()}),(0,n.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(0,n.jsx)("code",{className:"text-xs",children:e.size})}),(0,n.jsx)(y.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(d=null==J?void 0:J.tables)&&void 0!==d?d:[]).find(t=>t.id===e.id)?(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(V.Z,{strokeWidth:2,className:"text-brand"})}):(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(W.Z,{strokeWidth:2,className:"text-foreground-lighter"})})}),(0,n.jsx)(y.Z.td,{children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(u.z,{asChild:!0,type:"default",iconRight:(0,n.jsx)(T.Z,{size:14,className:"text-foreground-light"}),className:"whitespace-nowrap hover:border-muted",style:{paddingTop:3,paddingBottom:3},children:(0,n.jsxs)(c(),{href:"/project/".concat(g,"/database/tables/").concat(e.id),children:[null===(r=e.columns)||void 0===r?void 0:r.length," columns"]})}),!ee&&(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(f.Z,{})})}),(0,n.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsx)(p.Xi,{disabled:!Y,onClick:()=>a(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"Edit table"})]}),!Y&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit table"})})]})})]})}),(0,n.jsxs)(p.Xi,{className:"flex items-center space-x-2",onClick:()=>o.push("/project/".concat(null==S?void 0:S.ref,"/editor/").concat(e.id)),children:[(0,n.jsx)(O.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"View table"})]}),(0,n.jsx)(p.Xi,{disabled:!Y||ee,onClick:()=>l(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(v.Z,{stroke:"red",size:"tiny"}),(0,n.jsx)("p",{children:"Delete table"})]}),!Y&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to delete table"})})]})})]})})]})]})]})})]},e.id)})]})})})]})},U=a(829),B=a.n(U),M=a(68806),Q=a(8609),H=a(89404),X=a(81076),K=a(89777),G=a(48699),J=a(45997),$=a(14491),ee=a(88883),et=a(63955),ea=a(62202),en=a(49251),es=a(22574),er=a(42070),el=a(93705),ei=a(30195),eo=a(14698),ec=a(85945),ed=a(48228),eu=a(4224),em=a(18592);async function ex(e){let{projectRef:t,connectionString:a,payload:n}=e,s=eu.Z.roles.create(n).sql,{result:r}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:s,queryKey:["roles","create"]});return r}let eh=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>ex(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,J.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to create database role: ".concat(e.message)):t(e,a,n)},...a})};var ep=a(31738);let ef=ei.ZP.object({name:ei.ZP.string().trim().min(1,"You must provide a name").default(""),isSuperuser:ei.ZP.boolean().default(!1),canLogin:ei.ZP.boolean().default(!1),canCreateRole:ei.ZP.boolean().default(!1),canCreateDb:ei.ZP.boolean().default(!1),isReplicationRole:ei.ZP.boolean().default(!1),canBypassRls:ei.ZP.boolean().default(!1)}),ej={name:"",isSuperuser:!1,canLogin:!1,canCreateRole:!1,canCreateDb:!1,isReplicationRole:!1,canBypassRls:!1};var ev=e=>{let{visible:t,onClose:a}=e,s="create-new-role",{project:r}=(0,F.d2)(),l=(0,et.cI)({resolver:(0,ee.F)(ef)}),{mutate:i,isLoading:o}=eh({onSuccess:(e,t)=>{ea.ZP.success("Successfully created new role: ".concat(t.payload.name)),d()}}),c=async e=>{if(!r)return console.error("Project is required");i({projectRef:r.ref,connectionString:r.connectionString,payload:e})},d=()=>{a(),l.reset(ej)};return(0,n.jsx)(en.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:d,customFooter:(0,n.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,n.jsx)(eo.iN,{form:s,isSubmitting:o,hasChanges:l.formState.isDirty,handleReset:d})}),children:(0,n.jsx)(es.l0,{...l,children:(0,n.jsxs)("form",{id:s,className:"grid gap-6 w-full px-8 py-8",onSubmit:l.handleSubmit(c),children:[(0,n.jsx)(es.Wi,{control:l.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)(es.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,n.jsx)(es.NI,{className:"col-span-8",children:(0,n.jsx)(er.I,{...t,className:"w-full"})}),(0,n.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,n.jsx)("div",{className:"col-span-4",children:(0,n.jsx)(es.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Role privileges"})}),(0,n.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(ep.IC).filter(e=>ep.IC[e].grant_by_dashboard).map(e=>{let t=ep.IC[e];return(0,n.jsx)(es.Wi,{control:l.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)(es.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)(es.NI,{className:"col-span-8 flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(el.r,{checked:a.value,onCheckedChange:a.onChange}),(0,n.jsx)(es.lX,{children:t.description})]})}),(0,n.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,n.jsx)(en.ZP.Separator,{}),(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(ep.IC).filter(e=>!ep.IC[e].grant_by_dashboard).map(e=>{let t=ep.IC[e];return(0,n.jsx)(es.Wi,{control:l.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)(es.xJ,{className:"space-y-0 opacity-70",children:[(0,n.jsx)(es.NI,{className:"flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(el.r,{checked:a.value,onCheckedChange:a.onChange,disabled:!0,"aria-readonly":!0}),(0,n.jsx)(es.lX,{children:t.description})]})}),(0,n.jsx)(es.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},eb=a(47852);async function eg(e){let{projectRef:t,connectionString:a,id:n,payload:s}=e,r=eu.Z.roles.remove({id:n},s).sql,{result:l}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:r,queryKey:["roles","delete"]});return l}let ey=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>eg(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,J.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to delete database role: ".concat(e.message)):t(e,a,n)},...a})};var eN=e=>{let{role:t,visible:a,onClose:s}=e,{project:r}=(0,F.d2)(),{mutate:l,isLoading:i}=ey({onSuccess:()=>{ea.ZP.success("Successfully deleted role: ".concat(t.name)),s()}}),o=async()=>r?t?void l({projectRef:r.ref,connectionString:r.connectionString,id:t.id}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,n.jsx)(eb.C,{size:"small",alignFooter:"right",visible:a,onCancel:s,onConfirm:o,header:(0,n.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:i,children:(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(eb.C.Content,{children:(0,n.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})})},ew=a(62277),e_=a(11992),eS=a(4361),eC=a(22854),eZ=a(66855);async function ek(e){let{projectRef:t,connectionString:a,id:n,payload:s}=e,r=eu.Z.roles.update({id:n},s).sql,{result:l}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:r,queryKey:["roles","update"]});return l}let ez=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>ek(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,J.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to update database role: ".concat(e.message)):t(e,a,n)},...a})};var eE=e=>{let{role:t,disabled:a=!1,onSelectDelete:r}=e,{project:l}=(0,F.d2)(),[i,o]=(0,d.useState)(!1),{mutate:c,isLoading:m}=ez(),{isSuperuser:x,canLogin:h,canCreateRole:j,canCreateDb:b,isReplicationRole:g,canBypassRls:y}=t,N=async(e,a)=>{let{resetForm:n}=a;if(!l)return console.error("Project is required");let s=Object.fromEntries(Object.entries(e).filter(e=>{let[a,n]=e;return n!==t[a]}));c({projectRef:l.ref,connectionString:l.connectionString,id:t.id,payload:s},{onSuccess:()=>{ea.ZP.success('Successfully updated role "'.concat(t.name,'"')),n({values:{...e},initialValues:{...e}})}})};return(0,n.jsx)(ew.Z,{name:"role-update-form",initialValues:{isSuperuser:x,canLogin:h,canCreateRole:j,canCreateDb:b,isReplicationRole:g,canBypassRls:y},onSubmit:N,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:e=>{let{values:l,initialValues:c,handleReset:d}=e,x=JSON.stringify(l)!==JSON.stringify(c);return(0,n.jsxs)(e_.ZP,{open:i,children:[(0,n.jsx)(e_.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&o(!i)},children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(eS.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,n.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[t.activeConnections>0&&(0,n.jsx)("div",{className:"relative h-2 w-2",children:(0,n.jsxs)("span",{className:"flex h-2 w-2",children:[(0,n.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,n.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,n.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.activeConnections>0?"text-foreground":"text-foreground-light"),children:[t.activeConnections," connections"]}),!a&&(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(f.Z,{})})}),(0,n.jsx)(p.AW,{side:"bottom",className:"w-[120px]",children:(0,n.jsxs)(p.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),r(t)},children:[(0,n.jsx)(v.Z,{className:"text-red-800",size:"tiny",strokeWidth:2}),(0,n.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,n.jsx)(e_.ZP.Content,{children:(0,n.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,n.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(ep.IC).map(e=>(0,n.jsx)(eC.Z,{size:"small",id:e,name:e,label:ep.IC[e].description,disabled:a||ep.IC[e].disabled,className:["roles-toggle",a||ep.IC[e].disabled?"opacity-50":""].join(" "),afterLabel:!a&&ep.IC[e].disabled?(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{type:"button",children:(0,n.jsx)(eZ.Z,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{align:"center",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,n.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]}):(0,n.jsx)(n.Fragment,{})},e))}),!a&&(0,n.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,n.jsx)(u.z,{type:"default",disabled:!x||m,onClick:()=>d(),children:"Cancel"}),(0,n.jsx)(u.z,{type:"primary",htmlType:"submit",disabled:!x||m,loading:m,children:"Save"})]})]})})]})}})},eI=a(54383),eT=e=>{let{index:t}=e;return(0,n.jsx)("div",{className:(0,eI.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(eS.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)(w.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t}),(0,n.jsx)(w.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t})]})]}),(0,n.jsx)(w.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t})]})})},eR=()=>{let{project:e}=(0,F.d2)(),[t,a]=(0,d.useState)(""),[l,i]=(0,d.useState)("all"),[o,c]=(0,d.useState)(!1),[x,h]=(0,d.useState)(),p=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:f}=(0,$.E)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),j=null==f?void 0:f.maxConnections,{data:v,isLoading:b}=(0,J.x)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),g=B()(null!=v?v:[],e=>e.name.toLocaleLowerCase()),y=("active"===l?g.filter(e=>e.activeConnections>0):g).filter(e=>e.name.includes(t)),[N,w]=I()(y,e=>ep.NM.includes(e.name)),S=g.map(e=>e.activeConnections).reduce((e,t)=>e+t,0),C=B()(g.filter(e=>e.activeConnections>0),e=>-e.activeConnections);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(m.Z,{size:"small",placeholder:"Search for a role",icon:(0,n.jsx)(M.Z,{size:12}),value:t,onChange:e=>a(e.target.value),actions:t&&(0,n.jsx)(u.z,{size:"tiny",type:"text",onClick:()=>a(""),className:"px-1 mr-1",children:(0,n.jsx)(Q.Z,{size:12,strokeWidth:2})})}),(0,n.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[34px]",children:[(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("all"),children:"All roles"}),(0,n.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("active"),children:"Active roles"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{children:(0,n.jsx)("div",{className:"w-42",children:(0,n.jsx)(G.Z,{type:"horizontal",max:j||S,value:S,barClass:0===j||void 0===j?"bg-foreground":S>.9*j?"bg-destructive":S>.75*j?"bg-warning":void 0,labelTop:Number.isInteger(j)?"".concat(S,"/").concat(j):"".concat(S),labelBottom:"Active connections"})})}),(0,n.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,n.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),C.map(e=>(0,n.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.activeConnections]},e.id))]})]})]}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"primary",disabled:!p,icon:(0,n.jsx)(H.Z,{size:12}),onClick:()=>c(!0),children:"Add role"})}),!p&&(0,n.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs",children:"You need additional permissions to add a new role"})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[N.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,n.jsx)(X.C,{variant:"brand",children:"Protected"})]}),b?Array.from({length:5}).map((e,t)=>(0,n.jsx)(eT,{index:t},t)):N.map(e=>(0,n.jsx)(eE,{disabled:!0,role:e,onSelectDelete:h},e.id))]}),w.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),b?Array.from({length:3}).map((e,t)=>(0,n.jsx)(eT,{index:t},t)):w.map(e=>(0,n.jsx)(eE,{disabled:!p,role:e,onSelectDelete:h},e.id))]})]}),t.length>0&&0===y.length&&(0,n.jsx)(K.Z,{searchString:t,onResetFilter:()=>a("")}),(0,n.jsx)(ev,{visible:o,onClose:()=>c(!1)}),(0,n.jsx)(eN,{role:x,visible:void 0!==x,onClose:()=>h(void 0)})]})},eF=a(25877),eA=a.n(eF),eD=a(39459),eP=a(32830),eq=a(61531),eL=a(72081),eV=a(66020),eW=e=>{let{index:t=0}=e;return(0,n.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,n.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,n.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,n.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,n.jsx)(w.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t})})}),(0,n.jsx)(eC.Z,{size:"tiny",checked:!1,disabled:!0})]}),(0,n.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,n.jsx)("div",{className:"py-3 px-4",children:(0,n.jsx)(w.Z,{className:"h-4 w-48",delayIndex:t})})})]})};let eO=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_prewarm","pg_surgery","pg_visibility","pgstattuple","supabase_vault","supautils","intagg","xml2","pg_tle"],eY={vector:["pgvector","pg_vector"]};var eU=()=>{let{filter:e}=(0,b.UO)(),{project:t}=(0,F.d2)(),[a,s]=(0,d.useState)(""),{data:l,isLoading:i}=(0,eL.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),o=0===a.length?null!=l?l:[]:(null!=l?l:[]).filter(e=>{let t=e.name.toLowerCase().includes(a.toLowerCase()),n=(eY[e.name]||[]).some(e=>e.includes(a.toLowerCase()));return t||n}),h=o.filter(e=>!eO.includes(e.name)),[p,f]=I()(h,e=>!eA()(e.installed_version)),j=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),v=(0,_.N4)();return(0,d.useEffect)(()=>{void 0!==e&&s(e)},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(m.Z,{size:"small",placeholder:"Search for an extension",value:a,onChange:e=>s(e.target.value),className:"w-64",icon:(0,n.jsx)(x.Z,{size:"tiny"})}),v&&!j?(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(eq.Z,{icon:(0,n.jsx)(eD.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database extensions"})}):(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eP.Z,{}),children:(0,n.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions",target:"_blank",rel:"noreferrer",children:"Documentation"})})]})}),i?(0,n.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(w.Z,{className:"h-[28px] w-40"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,n.jsx)(eW,{index:t},t))})]})}):(0,n.jsxs)(n.Fragment,{children:[0===o.length&&(0,n.jsx)(K.Z,{searchString:a,onResetFilter:()=>s("")}),(0,n.jsxs)("div",{className:"my-8 w-full space-y-12",children:[p.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:p.map(e=>(0,n.jsx)(eV.Z,{extension:e},e.name))})]}),f.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:f.map(e=>(0,n.jsx)(eV.Z,{extension:e},e.name))})]})]})]})]})},eB=a(45455),eM=a.n(eB),eQ=a(16016),eH=a(18545);function eX(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var eK=a(61469),eG=a(16623);function eJ(e){let{wrapperMeta:t,formState:a,tables:n}=e,s=n.filter(e=>e.is_new_schema).map(e=>"create schema if not exists ".concat(e.schema_name,";")).join("\n"),r="\n    create foreign data wrapper ".concat(a.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),l=t.server.options.filter(e=>e.encrypted),i=t.server.options.filter(e=>!e.encrypted),o=l.map(e=>{let t="".concat(a.wrapper_name,"_").concat(e.name),n=(a[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(n,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")}).join("\n"),c=[...l.map(e=>"".concat(e.name," ''%s''")),...i.map(e=>"".concat(e.name," ''").concat(a[e.name],"''"))].join(","),d="\n    do $$\n    declare\n      ".concat(l.map(e=>"v_".concat(e.name," text;")).join("\n"),"\n    begin\n      ").concat(l.map(e=>"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(a.wrapper_name,"_").concat(e.name,"' limit 1;")).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(a.server_name,"\\n'\n        '   foreign data wrapper ").concat(a.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(c,"\\n'\n        '   );',\n        ").concat(l.map(e=>"v_".concat(e.name)).join(",\n"),"\n      );\n    end $$;\n  "),u=n.map(e=>{let t=e.columns;return'\n        create foreign table "'.concat(e.schema_name,'"."').concat(e.table_name,'" (\n          ').concat(t.map(e=>'"'.concat(e.name,'" ').concat(e.type)).join(",\n          "),"\n        )\n        server ").concat(a.server_name,"\n        options (\n          ").concat(Object.entries(e).filter(e=>{let[t,a]=e;return"table_name"!==t&&"schema_name"!==t&&"columns"!==t&&"index"!==t&&"is_new_schema"!==t&&!!a}).map(e=>{let[t,a]=e;return"".concat(t," '").concat(a,"'")}).join(",\n          "),"\n        );\n      ")}).join("\n\n");return"\n    ".concat(s,"\n\n    ").concat(r,"\n\n    ").concat(o,"\n\n    ").concat(d,"\n\n    ").concat(u,"\n  ")}async function e$(e){let{projectRef:t,connectionString:a,wrapperMeta:n,formState:s,tables:r}=e,l=eX(eJ({wrapperMeta:n,formState:s,tables:r})),{result:i}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:l});return i}let e0=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>e$(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(eG.C.list(r)),n.invalidateQueries(eH.M.query(r,["fdws"]),{refetchType:"all"}),n.invalidateQueries(eQ.H.list(r)),n.invalidateQueries(eH.M.query(r,eK.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to create ".concat(a.wrapperMeta.label," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})};var e2=a(19278),e1=a(17172),e4=a(84447),e3=a(57394),e5=e=>{var t,a,s;let{option:r,loading:l,error:i}=e,[o,x]=(0,d.useState)(!r.hidden);return r.isTextArea?(0,n.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,n.jsx)(m.Z.TextArea,{rows:6,error:i,className:"input-mono",disabled:l,id:r.name,name:r.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:r.label}),void 0!==r.urlHelper&&(0,n.jsx)(c(),{href:r.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eZ.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),value:l?"Fetching value from Vault...":void 0,defaultValue:null!==(t=r.defaultValue)&&void 0!==t?t:"",required:null!==(a=r.required)&&void 0!==a&&a},r.name)}):(0,n.jsx)(m.Z,{id:r.name,name:r.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:r.label}),void 0!==r.urlHelper&&(0,n.jsx)(c(),{href:r.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eZ.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),defaultValue:null!==(s=r.defaultValue)&&void 0!==s?s:"",error:i,value:l?"Fetching value from Vault...":void 0,type:!r.hidden||l?"text":o?"text":"password",disabled:l,actions:l?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(u.z,{disabled:!0,type:"default",icon:(0,n.jsx)(e4.Z,{className:"animate-spin"})})}):r.hidden?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(u.z,{type:"default",icon:o?(0,n.jsx)(O.Z,{}):(0,n.jsx)(e3.Z,{}),onClick:()=>x(!o)})}):null},r.name)},e6=a(39771),e9=a(62284),e8=a(82796),e7=a(96694),te=a(38591);let tt=[{name:"",type:"text"}];var ta=e=>{let{initialColumns:t=tt,onChange:a,errors:s={}}=e,[r,l]=(0,d.useReducer)((e,t)=>{switch(t.type){case"ADD_COLUMN":return{...e,columns:{...e.columns,[e.nextId]:{id:e.nextId,name:"",type:"text"}},nextId:e.nextId+1};case"REMOVE_COLUMN":return{...e,columns:Object.fromEntries(Object.entries(e.columns).filter(e=>{let[a]=e;return Number(a)!==t.payload.id}))};case"UPDATE_COLUMN":return{...e,columns:{...e.columns,[t.payload.id]:{...e.columns[t.payload.id],[t.payload.key]:t.payload.value}}};default:return e}},{columns:Object.fromEntries(t.map((e,t)=>[t,{...e,id:t}])),nextId:t.length}),i=(0,te.Z)(a);(0,d.useEffect)(()=>{var e;null===(e=i.current)||void 0===e||e.call(i,tn(r.columns))},[r.columns]);let o=()=>{l({type:"ADD_COLUMN"})},c=e=>{l({type:"REMOVE_COLUMN",payload:{id:e}})},x=(e,t,a)=>{l({type:"UPDATE_COLUMN",payload:{id:e,key:t,value:a}})},h=tn(r.columns);return(0,n.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4",children:h.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(m.Z,{className:"flex-1 [&_label]:!p-0",layout:"vertical",label:"Name",value:e.name,onChange:t=>x(e.id,"name",t.target.value)}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(e7.Z,{value:e.type,enumTypes:[],onOptionSelect:t=>x(e.id,"type",t),layout:"vertical",className:"[&_label]:!p-0"})}),(0,n.jsx)(u.z,{onClick:()=>c(e.id),icon:(0,n.jsx)(W.Z,{size:14,strokeWidth:1.5}),type:"outline",className:"self-end -translate-y-1 !px-2 !py-2"})]}),s["columns.".concat(t)]&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:s["columns.".concat(t)]})]},e.id))}),(0,n.jsx)(u.z,{type:"default",onClick:()=>o(),className:"self-start",children:"Add column"})]})};function tn(e){return Object.values(e).sort((e,t)=>e.id-t.id)}var ts=a(52093);let tr=e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),a=new Set(Array.from(t).filter(e=>e.includes("."))),n=Array.from(a);return e=>Object.fromEntries(Object.entries(e).flatMap(e=>{let[t,a]=e;return Array.isArray(a)?[[t,a],...a.map((e,a)=>["".concat(t,".").concat(a),e])]:[[t,a]]}).filter(e=>{let[s,r]=e,[l,i]=s.split(".");if(void 0!==i&&t.has(l)&&Object.keys(r).some(e=>a.has("".concat(l,".").concat(e)))){let e=n.find(e=>e.startsWith("".concat(l,".")));return!!e&&!r[e.split(".")[1]]}return t.has(l)&&(Array.isArray(r)?r.length<1:!r)}).map(e=>{let[t]=e;return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}))},tl=(e,t)=>{var a;return(null!==(a=null==e?void 0:e.tables)&&void 0!==a?a:[]).map(a=>{var n,s,r;let l=0,i=Object.fromEntries(a.options.map(e=>e.split("=")));switch(e.handler){case ts.I.STRIPE:l=null!==(n=null==t?void 0:t.tables.findIndex(e=>{var t;return(null===(t=e.options.find(e=>"object"===e.name))||void 0===t?void 0:t.defaultValue)===i.object}))&&void 0!==n?n:0;break;case ts.I.FIREBASE:l="auth/users"===i.object?null!==(s=null==t?void 0:t.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue)))&&void 0!==s?s:0:null!==(r=null==t?void 0:t.tables.findIndex(e=>"Firestore Collection"===e.label))&&void 0!==r?r:0;case ts.I.S3:case ts.I.AIRTABLE:case ts.I.LOGFLARE:case ts.I.BIG_QUERY:case ts.I.CLICK_HOUSE:}return{...i,index:l,columns:a.columns,is_new_schema:!1,schema:a.schema,schema_name:a.schema,table_name:a.name}})},ti=e=>Object.fromEntries(e.map(e=>e.split("=")));var to=e=>{let{visible:t,onCancel:a,onSave:s,tables:r,initialData:l}=e,[i,o]=(0,d.useState)("");(0,d.useEffect)(()=>{l&&o(String(l.index))},[l]);let c=""===i?void 0:r[parseInt(i)],u=()=>{o(""),a()};return(0,n.jsx)(en.ZP,{size:"medium",visible:t,onCancel:u,header:(0,n.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,n.jsx)(e6.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:u}),children:(0,n.jsx)(en.ZP.Content,{children:(0,n.jsxs)("div",{className:"my-4 space-y-6",children:[(0,n.jsxs)(e9.Z,{size:"small",label:"Select a target the table will point to",value:i,onChange:e=>o(e),children:[(0,n.jsx)(e9.Z.Option,{value:"",label:"---",children:"---"},"empty"),r.map((e,t)=>(0,n.jsx)(e9.Z.Option,{className:"group",value:String(t),label:e.label,children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{children:e.label}),(0,n.jsx)("p",{className:"opacity-50",children:e.description})]})},String(t)))]}),c&&(0,n.jsx)(td,{table:c,onSubmit:(e,t)=>{let{resetForm:a}=t;s({...e,index:parseInt(i),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema}),a(),o("")},initialData:l})]})})},"WrapperTableEditor")};let tc=e=>{var t,a,s;let{option:r}=e;return"select"===r.type?(0,n.jsx)(e9.Z,{id:r.name,name:r.name,label:r.label,defaultValue:null!==(t=r.defaultValue)&&void 0!==t?t:"",children:[...r.required?[]:[(0,n.jsx)(e9.Z.Option,{value:"",label:"---",children:"---"},"empty")],...r.options.map(e=>(0,n.jsx)(e9.Z.Option,{id:r.name+e.value,value:e.value,label:e.label,children:e.label},e.value))]},r.name):(0,n.jsx)(m.Z,{id:r.name,name:r.name,label:r.label,placeholder:null!==(a=r.placeholder)&&void 0!==a?a:"",defaultValue:null!==(s=r.defaultValue)&&void 0!==s?s:""},r.name)},td=e=>{var t,a,s;let{table:r,onSubmit:l,initialData:i}=e,{project:o}=(0,F.d2)(),{data:c,isLoading:d,isSuccess:u}=(0,P.Q)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),x=null!==(t=r.options.filter(e=>e.editable&&e.required&&!e.defaultValue))&&void 0!==t?t:[],p=null!==(a=r.options.filter(e=>e.editable&&(!e.required||e.defaultValue)))&&void 0!==a?a:[],f=null!=i?i:{table_name:"",columns:null!==(s=r.availableColumns)&&void 0!==s?s:[],...Object.fromEntries(r.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})),schema:"public",schema_name:""},j=tr([...r.options,{name:"table_name",required:!0},{name:"columns",required:!0},...r.availableColumns?[]:[{name:"columns.name",required:!0}]]);return(0,n.jsx)(ew.Z,{id:"wrapper-table-editor-form",initialValues:f,validate:j,onSubmit:l,enableReinitialize:!0,children:e=>{var t;let{errors:a,values:s,setFieldValue:l}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[d&&(0,n.jsx)(w.Z,{className:"py-4"}),u&&(0,n.jsxs)(e9.Z,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,n.jsx)(e9.Z.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:()=>(0,n.jsx)(h.Z,{size:16,strokeWidth:1.5}),children:"Create a new schema"},"custom"),(0,n.jsx)(eb.C.Separator,{}),null===(t=null!=c?c:[])||void 0===t?void 0:t.map(e=>(0,n.jsx)(e9.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,n.jsx)(e8.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]}),"custom"===s.schema&&(0,n.jsx)(m.Z,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,n.jsx)(m.Z,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),x.map(e=>(0,n.jsx)(tc,{option:e},e.name)),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"!w-full",children:r.availableColumns?"Select the columns to be added to your table":"Add columns to your table"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:r.availableColumns?r.availableColumns.map(e=>{let t=!!s.columns.find(t=>t.name===e.name);return(0,n.jsx)("div",{className:["px-2 py-1 rounded cursor-pointer transition","".concat(t?"bg-brand-300":"bg-surface-300 hover:bg-selection")].join(" "),onClick:()=>{t?l("columns",s.columns.filter(t=>t.name!==e.name)):l("columns",s.columns.concat([e]))},children:(0,n.jsx)("p",{className:"text-sm",children:e.name})},e.name)}):(0,n.jsx)(ta,{initialColumns:s.columns,onChange:e=>{l("columns",e)},errors:a})}),a.columns&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:a.columns})]}),p.map(e=>(0,n.jsx)(tc,{option:e},e.name))]})}})};var tu=()=>{var e,t;let a="create-wrapper-form",s=(0,R.useRouter)(),l=(0,ec.NL)(),{ref:i,type:o}=(0,b.UO)(),{project:x}=(0,F.d2)(),h=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),[p,f]=(0,d.useState)([]),[g,y]=(0,d.useState)(!1),[N,w]=(0,d.useState)(),[S,C]=(0,d.useState)({}),{mutate:Z,isLoading:k}=e0({onSuccess:()=>{ea.ZP.success("Successfully created ".concat(null==z?void 0:z.label," foreign data wrapper")),f([]),p.some(e=>e.is_new_schema)&&(0,P.X)(l,i),s.push("/project/".concat(i,"/database/wrappers"))}}),z=ts._.find(e=>e.name===o),E=void 0!==z?{wrapper_name:"",server_name:"",...Object.fromEntries(z.server.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))}:{},{data:I}=(0,eL.H)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),T=null==I?void 0:I.find(e=>"wrappers"===e.name),A=(null!==(e=null==T?void 0:T.installed_version)&&void 0!==e?e:"")>=(null!==(t=null==z?void 0:z.minimumExtensionVersion)&&void 0!==t?t:"");if(void 0===z)return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unsupported wrapper type"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",o," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(c(),{href:"/project/".concat(i,"/database/wrappers"),children:"Head back"})})]});if(!A){let e=(null==T?void 0:T.installed_version)!==(null==T?void 0:T.default_version);return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Your extension version is outdated for this wrapper."}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",o," requires a minimum extension version of"," ",z.minimumExtensionVersion,". You have version"," ",null==T?void 0:T.installed_version," installed. Please"," ",e&&"upgrade your database then ","reinstall the extension to create this wrapper."]})]}),(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(c(),{href:e?"/project/".concat(i,"/settings/infrastructure"):"/project/".concat(i,"/database/extensions?filter=wrappers"),children:e?"Upgrade Database":"Reinstall Extension"})})]})}let D=async e=>{let t=tr(z.server.options)(e),{wrapper_name:a}=e;if(0===a.length&&(t.name="Please provide a name for your wrapper"),0===p.length&&(t.tables="Please add at least one table"),!eM()(t))return C(t);Z({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,wrapperMeta:z,formState:{...e,server_name:"".concat(a,"_server")},tables:p})};return(0,n.jsxs)(eo.ld,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(c(),{href:"/project/".concat(i,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(e2.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Create a ",z.label," Wrapper"]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e1.Z,{strokeWidth:1.5}),children:(0,n.jsx)(c(),{href:z.docsUrl,target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,n.jsx)(ew.Z,{id:a,initialValues:E,onSubmit:D,children:e=>{var t;let{handleReset:s,values:r,initialValues:l}=e,i=JSON.stringify(r)!==JSON.stringify(l);return(0,n.jsxs)(eo.by,{disabled:!h,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(eo.iN,{form:a,isSubmitting:k,hasChanges:i,handleReset:s,disabled:!h,helper:h?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,n.jsx)(eo.hj,{header:(0,n.jsx)(eo.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(eo.B4,{loading:!1,children:(0,n.jsx)(m.Z,{id:"wrapper_name",label:"Wrapper Name",error:S.wrapper_name,descriptionText:(null!==(t=null==r?void 0:r.wrapper_name)&&void 0!==t?t:"").length>0?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]}):""})})}),(0,n.jsx)(eo.hj,{header:(0,n.jsxs)(eo.S0,{children:[z.label," Configuration"]}),children:(0,n.jsx)(eo.B4,{loading:!1,children:z.server.options.map(e=>(0,n.jsx)(e5,{option:e,loading:!1,error:S[e.name]},e.name))})}),(0,n.jsx)(eo.hj,{header:(0,n.jsxs)(eo.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(eo.B4,{loading:!1,children:[0===p.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>y(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:p.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Columns:"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{y(!0),w({...e,tableIndex:t})}}),(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(v.Z,{}),onClick:()=>{f(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name)))}),p.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>y(!0),children:"Add foreign table"})}),0===p.length&&S.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:S.tables})]})})]})}})]}),(0,n.jsx)(to,{visible:g,tables:z.tables,onCancel:()=>{w(void 0),y(!1)},onSave:e=>{f(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),y(!1),w(void 0)},initialData:N})]})},tm=a(25733);let tx=e=>{let{wrapper:t,wrapperMeta:a}=e,n=a.server.options.filter(e=>e.encrypted).map(e=>{let a="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(a,"');\n\n      delete from pgsodium.key where name = '").concat(a,"';\n    ")}).join("\n");return"\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(n,"\n  ")};async function th(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:s}=e,r=eX(tx({wrapper:n,wrapperMeta:s})),{result:l}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:r});return l}let tp=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>th(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(eG.C.list(r)),n.invalidateQueries(eH.M.query(r,["fdws"])),n.invalidateQueries(eQ.H.list(r)),n.invalidateQueries(eH.M.query(r,eK.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to disable ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})},tf=e=>{let{wrapper:t,wrapperMeta:a,formState:n,tables:s}=e,r=tx({wrapper:t,wrapperMeta:a}),l=eJ({wrapperMeta:a,formState:n,tables:s});return"\n    ".concat(r,"\n\n    ").concat(l,"\n  ")};async function tj(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:s,formState:r,tables:l}=e,i=eX(tf({wrapper:n,wrapperMeta:s,formState:r,tables:l})),{result:o}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:i});return o}let tv=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>tj(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(eG.C.list(r)),n.invalidateQueries(eH.M.query(r,["fdws"])),n.invalidateQueries(eQ.H.list(r)),n.invalidateQueries(eH.M.query(r,eK.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to update ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})};var tb=a(67208),tg=a(62804),ty=a(77542),tN=()=>{var e,t;let a="edit-wrapper-form",s=(0,R.useRouter)(),l=(0,ec.NL)(),{ref:i,id:o}=(0,b.UO)(),{project:x}=(0,F.d2)(),{data:h,isLoading:p}=(0,tb.y)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),{data:f,isLoading:g}=(0,ty.f)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),y=(null!==(e=null==h?void 0:h.result)&&void 0!==e?e:[]).find(e=>Number(e.id)===Number(o)),N=(0,_.Je)(y),w=ts._.find(e=>e.handlerName===(null==N?void 0:N.handler)),{mutate:S,isLoading:C}=tv({onSuccess:()=>{ea.ZP.success("Successfully updated ".concat(null==w?void 0:w.label," foreign data wrapper")),k([]),Z.some(e=>e.is_new_schema)&&(0,P.X)(l,i),s.push("/project/".concat(i,"/database/wrappers"))}}),[Z,k]=(0,d.useState)([]),[z,E]=(0,d.useState)(!1),[I,T]=(0,d.useState)(),[A,D]=(0,d.useState)({}),q=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),L=void 0!==w?{wrapper_name:null==N?void 0:N.name,server_name:null==N?void 0:N.server_name,...ti(null!==(t=null==N?void 0:N.server_options)&&void 0!==t?t:[])}:{};if((0,d.useEffect)(()=>{(null==N?void 0:N.id)&&k(tl(N,w))},[null==N?void 0:N.id]),p)return(0,n.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,n.jsx)(tm.Z,{})});if(void 0===N||void 0===w)return C?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(e4.Z,{className:"animate-spin",size:16}),(0,n.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unknown wrapper"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper ID ",o," cannot be found in your project. Head back to select another wrapper."]})]}),(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(c(),{href:"/project/".concat(i,"/database/wrappers"),children:"Head back"})})]});let V=async e=>{let t=tr(w.server.options)(e),{wrapper_name:a}=e;if(0===a.length&&(t.name="Please provide a name for your wrapper"),0===Z.length&&(t.tables="Please add at least one table"),!eM()(t))return D(t);S({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,wrapper:N,wrapperMeta:w,formState:{...e,server_name:"".concat(a,"_server")},tables:Z})};return(0,n.jsxs)(eo.ld,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(c(),{href:"/project/".concat(i,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(e2.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Edit ",w.label," wrapper: ",N.name]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e1.Z,{strokeWidth:1.5}),children:(0,n.jsx)(c(),{href:"https://supabase.github.io/wrappers/stripe/",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,n.jsx)(ew.Z,{id:a,initialValues:L,onSubmit:V,children:e=>{var t;let{handleReset:s,values:r,initialValues:l,resetForm:i}=e,[o,c]=(0,d.useState)(!1),h=tl(null!==(t=null==N?void 0:N.tables)&&void 0!==t?t:[]),p=JSON.stringify(r)!==JSON.stringify(l),b=JSON.stringify(h)!==JSON.stringify(Z),y=w.server.options.filter(e=>e.encrypted);return(0,d.useEffect)(()=>{let e=async()=>{if(c(!0),g)return;let e=(await Promise.all(y.map(async e=>{let t=null==f?void 0:f.find(t=>t.name==="".concat(N.name,"_").concat(e.name));if(void 0===t)return{[e.name]:""};{let a=await (0,tg.mp)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,id:t.id});return{[e.name]:a[0].decrypted_secret}}}))).reduce((e,t)=>{let[a]=Object.keys(t);return{...e,[a]:t[a]}},{});i({values:{...r,...e},initialValues:{...l,...e}}),c(!1)};y.length>0&&e()},[g]),(0,n.jsxs)(eo.by,{disabled:!q,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(eo.iN,{form:a,isSubmitting:C,hasChanges:p||b,handleReset:()=>{s(),k(h)},disabled:!q,helper:q?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,n.jsx)(eo.hj,{header:(0,n.jsx)(eo.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(eo.B4,{loading:!1,children:(0,n.jsx)(m.Z,{id:"wrapper_name",label:"Wrapper Name",error:A.wrapper_name,descriptionText:r.wrapper_name!==l.wrapper_name?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]}):(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name is"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]})})})}),(0,n.jsx)(eo.hj,{header:(0,n.jsxs)(eo.S0,{children:[w.label," Configuration"]}),children:(0,n.jsx)(eo.B4,{loading:!1,children:w.server.options.map(e=>(0,n.jsx)(e5,{option:e,loading:!!e.encrypted&&o,error:A[e.name]},e.name))})}),(0,n.jsx)(eo.hj,{header:(0,n.jsxs)(eo.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(eo.B4,{loading:!1,children:[0===Z.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>E(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:Z.map((e,t)=>{var a,s;null===(a=w.tables[e.index])||void 0===a||a.label;let r=null!==(s=null==e?void 0:e.table)&&void 0!==s?s:e.object;return(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name," "]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light mt-1",children:["Target: ",r]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Columns:"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{E(!0),T({...e,tableIndex:t})}}),(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(v.Z,{}),onClick:()=>{k(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),Z.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>E(!0),children:"Add foreign table"})}),0===Z.length&&A.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:A.tables})]})})]})}})]}),(0,n.jsx)(to,{visible:z,tables:w.tables,onCancel:()=>{T(void 0),E(!1)},onSave:e=>{k(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),E(!1),T(void 0)},initialData:I})]})},tw=a(3440),t_=a.n(tw),tS=e=>{let{selectedWrapper:t,onClose:a}=e,{project:s}=(0,F.d2)(),{mutate:r,isLoading:l}=tp({onSuccess:()=>{ea.ZP.success("Successfully disabled ".concat(null==t?void 0:t.name," foreign data wrapper")),a()}}),i=ts._.find(e=>e.handlerName===(null==t?void 0:t.handler)),o=async()=>(null==s?void 0:s.ref)?t?i?void r({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,wrapper:t,wrapperMeta:i}):console.error("Wrapper meta is required"):console.error("Wrapper is required"):console.error("Project ref is required");return(0,n.jsx)(eb.C,{size:"medium",alignFooter:"right",loading:l,visible:void 0!==t,onCancel:()=>a(),onConfirm:()=>o(),header:"Confirm to disable ".concat(null==t?void 0:t.name),children:(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(eb.C.Content,{children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to disable ",null==t?void 0:t.name,"? This will also remove all tables created with this wrapper."]})})})})},tC=a(38421),tZ=a.n(tC),tk=a(66760),tz=e=>{let{wrappers:t=[],wrapperMeta:a,isOpen:l,onOpen:i,onSelectDelete:o}=e,{ref:d}=(0,tk.UO)(),m=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(e_.ZP,{open:l,onOpenChange:()=>i(a.name),className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong col-span-12 mx-auto -space-y-px overflow-hidden transition border shadow hover:z-50 first:rounded-tl first:rounded-tr first:!border-t last:rounded-bl last:rounded-br last:border-t-0",children:[(0,n.jsx)(e_.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(eS.Z,{className:"transition text-border-stronger data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsx)(tZ(),{src:a.icon,width:20,height:20,alt:"".concat(a.name," wrapper icon")}),(0,n.jsx)("span",{className:"text-sm capitalize",children:a.label})]}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:(0,n.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-strong bg-surface-100 text-foreground",children:[t.length," wrapper",t.length>1?"s":""]})})]})}),(0,n.jsx)(e_.ZP.Content,{children:(0,n.jsx)("div",{className:"border-t group border-strong bg-surface-100 text-foreground divide-y",children:t.map(e=>{let t=Object.fromEntries(e.server_options.map(e=>e.split("="))),[r,l]=I()(a.server.options,"hidden");return(0,n.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("p",{className:"text-base",children:e.name})}),l.map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-foreground-light",children:[(0,n.jsxs)("p",{children:[e.label,":"]}),(0,n.jsx)("p",{children:t[e.name]})]},e.name)),r.map(t=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsxs)("p",{className:"text-foreground-light",children:[t.label,":"]}),(0,n.jsxs)(c(),{href:"/project/".concat(d,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),className:"transition text-foreground-light hover:text-foreground flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"Encrypted in Vault"}),(0,n.jsx)(eP.Z,{size:14,strokeWidth:1.5})]})]},t.name)),(0,n.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Foreign tables",e.tables&&": (".concat(e.tables.length,")")]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables?e.tables.map(e=>(0,n.jsx)(c(),{href:"/project/".concat(d,"/editor/").concat(e.id),children:(0,n.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-surface-200 hover:bg-overlay-hover",children:e.name})},e.id)):(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"No tables available"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[m?(0,n.jsx)(c(),{href:"/project/".concat(d,"/database/wrappers/").concat(e.id),children:(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(j.Z,{strokeWidth:1.5}),className:"py-2"})}):(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",disabled:!0,icon:(0,n.jsx)(j.Z,{strokeWidth:1.5}),className:"py-2"})}),!m&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit wrappers"})})]})})]}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",disabled:!m,icon:(0,n.jsx)(v.Z,{strokeWidth:1.5}),className:"py-2",onClick:()=>o(e)})}),!m&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})]})]},e.id)})})})]})})},tE=a(6659),tI=a(22238),tT=a(99248),tR=()=>{let{ref:e}=(0,b.UO)(),{resolvedTheme:t}=(0,tE.F)(),{project:a}=(0,F.d2)(),{data:l}=(0,eL.H)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),i=(null!=l?l:[]).find(e=>"wrappers"===e.name),o=(null!=l?l:[]).find(e=>"supabase_vault"===e.name),m=void 0===i||void 0===o,[x,h]=(0,d.useState)(!1),p=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),{mutateAsync:f}=(0,tI.k)({onError:()=>{}}),j=async()=>{if(void 0===i||void 0===o)return;if(void 0===a)return console.error("Project is required");let e=!1;try{var t,n;h(!0),await Promise.all([f({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(t=i.schema)&&void 0!==t?t:"extensions",name:i.name,version:i.default_version,cascade:!0}),f({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(n=o.schema)&&void 0!==n?n:"vault",name:o.name,version:o.default_version,cascade:!0})])}catch(t){t.message.includes("already exists")||(e=!0,ea.ZP.error("Failed to enable Wrappers: ".concat(t.message)))}finally{h(!1),e||ea.ZP.success("Wrappers are now enabled!")}};return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded-md bg-studio border-default",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:(null==t?void 0:t.includes("dark"))?'url("'.concat(tT.GW,'/img/wrappers-dark.png")'):'url("'.concat(tT.GW,'/img/wrappers-light.png")')},children:(0,n.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),m?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"rounded border border-default px-4 py-2 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Wrappers is not available for this project yet."}),(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,n.jsx)("div",{children:(0,n.jsx)(u.z,{asChild:!0,type:"primary",children:(0,n.jsx)(c(),{href:"/support/new?ref=".concat(e,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eP.Z,{}),children:(0,n.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})})})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eP.Z,{}),children:(0,n.jsx)(c(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"primary",loading:x,disabled:m||x||!p,onClick:()=>j(),children:"Enable Wrappers"})}),!p&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Wrappers for this project"})})]})})]})]})]})})})},tF=a(90609),tA=e=>{var t;let{isEnabled:a}=e,{project:s}=(0,F.d2)(),{data:r}=(0,tb.y)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),[l,i]=(0,d.useState)(""),[o,c]=(0,d.useState)(),u=null!==(t=null==r?void 0:r.result)&&void 0!==t?t:[],m=t_()(u,"handler");return(0,n.jsxs)(n.Fragment,{children:[a?(0,n.jsx)("div",{children:0===u.length?(0,n.jsxs)("div",{className:"border rounded border-default px-20 py-16 flex flex-col items-center justify-center space-y-4",children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"No wrappers created yet"}),(0,n.jsx)(tF.Z,{align:"center",buttonText:"Create a new wrapper"})]}):(0,n.jsx)(n.Fragment,{children:ts._.map((e,t)=>{var a;let s=null!==(a=m[e.handlerName])&&void 0!==a?a:[];return s.length>0?(0,n.jsx)(tz,{wrapperMeta:e,wrappers:s,isOpen:l===e.name,onOpen:e=>{l!==e?i(e):i("")},onSelectDelete:c},t):null})})}):(0,n.jsx)(tR,{}),(0,n.jsx)(tS,{selectedWrapper:o,onClose:()=>c(void 0)})]})},tD=a(74138),tP=a(26764),tq=e=>{let{index:t}=e;return(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:(0,n.jsx)(w.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t})}),(0,n.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:(0,n.jsx)(w.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t})}),Array.from({length:4}).map((e,t)=>(0,n.jsx)(y.Z.td,{children:(0,n.jsx)(eC.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(w.Z,{className:"h-6 w-12 p-0",delayIndex:t})})})]})},tL=e=>{let{onSelectPublication:t=i()}=e,{project:a}=(0,F.d2)(),[s,l]=(0,d.useState)(""),{data:o,isLoading:c}=(0,D.z)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),{mutate:h}=(0,tP.u)({onSuccess:()=>{ea.ZP.success("Successfully updated event"),g(null)}}),p=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),f=(0,_.N4)(),j=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],v=0===s.length?null!=o?o:[]:(null!=o?o:[]).filter(e=>e.name.includes(s)),[b,g]=(0,d.useState)(null),N=async()=>{if(!b||!a)return;let{publication:e,event:t,currentStatus:n}=b,s={projectRef:a.ref,connectionString:a.connectionString,id:e.id};s["publish_".concat(t.event.toLowerCase())]=!n,h(s)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(m.Z,{size:"small",icon:(0,n.jsx)(x.Z,{size:"tiny"}),placeholder:"Filter",value:s,onChange:e=>l(e.target.value)})}),f&&!p&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(eq.Z,{icon:(0,n.jsx)(eD.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database publications"})})]})}),(0,n.jsxs)("div",{className:"overflow-hidden rounded",children:[(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{style:{width:"25%"},children:"Name"},"header.name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",style:{width:"25%"},children:"System ID"},"header.id"),(0,n.jsx)(y.Z.th,{children:"Insert"},"header.insert"),(0,n.jsx)(y.Z.th,{children:"Update"},"header.update"),(0,n.jsx)(y.Z.th,{children:"Delete"},"header.delete"),(0,n.jsx)(y.Z.th,{children:"Truncate"},"header.truncate"),(0,n.jsx)(y.Z.th,{className:"text-right",children:"Source"},"header.source")],body:c?Array.from({length:5}).map((e,t)=>(0,n.jsx)(tq,{index:t},t)):v.map(e=>(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:e.name}),(0,n.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:e.id}),j.map(t=>(0,n.jsx)(y.Z.td,{children:(0,n.jsx)(eC.Z,{size:"tiny",checked:e[t.key],disabled:!p,onChange:()=>{g({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:(0,n.jsx)(u.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name))}),!c&&0===v.length&&(0,n.jsx)(K.Z,{searchString:s,onResetFilter:()=>l(""),className:"rounded-t-none border-t-0"})]}),(0,n.jsx)(tD.Z,{visible:null!==b,title:"Confirm to toggle sending ".concat(null==b?void 0:b.event.event.toLowerCase()," events"),confirmLabel:"Confirm",confirmLabelLoading:"Updating",onCancel:()=>g(null),onConfirm:()=>{N()},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to ",(null==b?void 0:b.currentStatus)?"stop":"start"," ","sending ",null==b?void 0:b.event.event.toLowerCase()," events for"," ",null==b?void 0:b.publication.name,"?"]})})]})},tV=a(52253),tW=e=>{var t;let{table:a,selectedPublication:s}=e,{project:l}=(0,F.d2)(),i=null==s.tables,[o,c]=(0,d.useState)((null===(t=s.tables)||void 0===t?void 0:t.find(e=>e.id==a.id))!=void 0),u=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:m,isLoading:x}=(0,tP.u)(),h=async(e,t)=>{var a;if(void 0===l)return console.error("Project is required");c(!o);let n=null!==(a=null==t?void 0:t.tables)&&void 0!==a?a:[],s=n.some(t=>t.id==e.id)?n.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(n.map(e=>"".concat(e.schema,".").concat(e.name)));m({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:t.id,tables:s},{onSuccess:()=>{ea.ZP.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{ea.ZP.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),c(o)}})};return(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{className:"whitespace-nowrap",children:a.name}),(0,n.jsx)(y.Z.td,{className:"whitespace-nowrap",children:a.schema}),(0,n.jsx)(y.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:a.comment}),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:i?(0,n.jsxs)(X.C,{children:[(0,n.jsx)("span",{children:"Enabled"}),(0,n.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,n.jsx)(eC.Z,{size:"tiny",align:"right",disabled:!u||x,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>h(a,s)})})})]},a.id)},tO=e=>{let{selectedPublication:t,onSelectBack:a}=e,{project:s}=(0,F.d2)(),[l,i]=(0,d.useState)(""),o=(0,_.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:c,isLoading:h,isSuccess:p,isError:f,error:j}=(0,q.Bj)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString},{select:e=>e.filter(e=>0===l.length?!C.F.includes(e.schema):!C.F.includes(e.schema)&&e.name.includes(l))});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(u.z,{type:"outline",onClick:()=>a(),icon:(0,n.jsx)(tV.Z,{}),style:{padding:"5px"}}),(0,n.jsx)("div",{children:(0,n.jsx)(m.Z,{size:"small",placeholder:"Filter",value:l,onChange:e=>i(e.target.value),icon:(0,n.jsx)(x.Z,{size:"tiny"})})})]}),!o&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(eq.Z,{icon:(0,n.jsx)(eD.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),h&&(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)(tm.Z,{})}),f&&(0,n.jsx)(N.Z,{error:j,subject:"Failed to retrieve tables"}),p&&(0===c.length?(0,n.jsx)(g.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"header-name"),(0,n.jsx)(y.Z.th,{children:"Schema"},"header-schema"),(0,n.jsx)(y.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,n.jsx)(y.Z.th,{},"header-all")],body:c.map((e,a)=>(0,n.jsx)(tW,{table:e,selectedPublication:t},e.id))})}))]})},tY=a(28879),tU=a.n(tY),tB=a(25309),tM=a(98611),tQ=a(64306),tH=a(75716),tX=a(31696);async function tK(e){let{ref:t,backup:a}=e;if(a.isPhysicalBackup){let{data:e,error:n}=await (0,tX.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:a.id,recovery_time_target:a.inserted_at}});if(n)throw n;return e}let{data:n,error:s}=await (0,tX.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:a.id}});return s&&(0,tX.S3)(s),n}let tG=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ed.D)(e=>tK(e),{async onSuccess(t,a,n){await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,a,n)},...a})};var tJ=a(73258),t$=a(26198),t0=a(23418);async function t2(e){let{ref:t,backup:a}=e,{data:n,error:s}=await (0,tX.v_)("/platform/database/{ref}/backups/download",{params:{path:{ref:t}},body:{id:a.id,inserted_at:a.inserted_at,project_id:a.project_id,data:{},s3_bucket:"deprecated",s3_path:"deprecated",status:"deprecated"}});return s&&(0,tX.S3)(s),n}let t1=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ed.D)(e=>t2(e),{async onSuccess(t,a,n){await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to download backup: ".concat(e.message)):t(e,a,n)},...a})};var t4=e=>{let{index:t,isHealthy:a,backup:s,projectRef:l,onSelectBackup:i}=e,o=(0,_.Xo)(r.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=t1({onSuccess:e=>{let{fileUrl:t}=e,a=document.createElement("a");a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}});return(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,n.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==s.status?"".concat(tU()(s.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):tU()(s.inserted_at).format("DD MMM YYYY")}),(0,n.jsx)("div",{children:"COMPLETED"===s.status?(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(u.z,{type:"default",disabled:!a||!o,onClick:i,children:"Restore"}),!s.isPhysicalBackup&&(0,n.jsx)(u.z,{type:"default",disabled:!o||d,onClick:()=>c({ref:l,backup:s}),loading:d,icon:(0,n.jsx)(t0.Z,{}),children:"Download"})]}):(0,n.jsx)(X.C,{variant:"warning",children:"Backup In Progress..."})})]})},t3=a(67211),t5=a(37397),t6=()=>{var e,t;let a=(0,R.useRouter)(),s=(0,ec.NL)();(0,_.lL)();let{project:l}=(0,F.d2)(),i=(null==l?void 0:l.ref)||"default",o=(null==l?void 0:l.status)===tT.S.ACTIVE_HEALTHY,[c,u]=(0,d.useState)(),m=(0,_.Xo)(r.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{data:x}=(0,tJ.T)({projectRef:i}),{mutate:h,isLoading:p,isSuccess:f}=tG({onSuccess:()=>{setTimeout(()=>{(0,t$.k7)(s,i,tT.S.RESTORING),ea.ZP.success("Restoring database back to ".concat(tU()(null==c?void 0:c.inserted_at).format("DD MMM YYYY HH:mm:ss"))),a.push("/project/".concat(i))},3e3)}}),j=null!==(e=null==x?void 0:x.tierKey)&&void 0!==e?e:"",v=(null!==(t=null==x?void 0:x.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),b=null==x?void 0:x.pitr_enabled;return"FREE"===j?(0,n.jsx)(tH.Z,{addon:"pitr",icon:(0,n.jsx)(tB.Z,{size:20}),primaryText:"Free Plan does not include project backups.",secondaryText:"Upgrade to the Pro plan for up to 7 days of scheduled backups."}):b?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"space-y-6",children:0===v.length&&"FREE"!==j?(0,n.jsx)(t3.Z,{}):(0,n.jsxs)(n.Fragment,{children:[!m&&(0,n.jsx)(eq.Z,{icon:(0,n.jsx)(tM.Z,{size:16,className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to trigger a scheduled backup"}),(0,n.jsx)(t5.Z,{}),(0,n.jsx)(tQ.Z,{children:null==v?void 0:v.map((e,t)=>(0,n.jsx)(t4,{backup:e,projectRef:i,index:t,isHealthy:o,onSelectBackup:()=>u(e)},e.id))})]})}),(0,n.jsx)(tD.Z,{size:"medium",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==c,title:"Confirm to restore from backup",loading:p||f,onCancel:()=>u(void 0),onConfirm:()=>{if(void 0===c)return console.error("Backup required");h({ref:i,backup:c})},children:(0,n.jsxs)("p",{children:["Are you sure you want to restore from"," ",tU()(null==c?void 0:c.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})},t9=a(87612),t8=a(93352),t7=a.n(t8),ae=a(34519),at=a.n(ae),aa=a(26139),an=a.n(aa),as=a(67304),ar=a.n(as),al=a(80075),ai=a(46776),ao=a(38183),ac=a(12934),ad=a(25633),au=a(46916),am=a(2515),ax=function(e){return(0,n.jsx)(am.Z,{icon:au.Z,...e})},ah=a(42756),ap=e=>{let{icon:t,text:a}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,n.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,n.jsx)("p",{className:"text-foreground-light",children:a})]})},af=a(7999),aj=a(7509),av=a(42002),ab=a(88354),ag=a(39148);async function ay(e){let{id:t,projectRef:a,connectionString:n,payload:s}=e,r=new Headers;n&&r.set("x-connection-encrypted",n);let l=await (0,ab.r$)("".concat(tT.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),s,{headers:Object.fromEntries(r)});if(l.error)throw l.error;return l}let aN=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>ay(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(ag.D.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,a,n)},...a})};var aw=a(42114),a_=a(16760),aS=a.n(a_),aC=a(84636),aZ=a.n(aC),ak=a(43687),az=a(62029),aE=a(70458),aI=e=>{let{triggerFunctions:t,visible:a,onChange:s,setVisible:r}=e,l=t.length>=1,i=aS()(aZ()(t,"schema"),"schema");function o(e){s(e),r(!a)}return(0,n.jsx)(en.ZP,{size:"large",header:"Pick a function",visible:a,onCancel:()=>r(!a),className:"hooks-sidepanel",children:(0,n.jsx)("div",{className:"py-6",children:l?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(aT,{}),i.map(e=>(0,n.jsx)(aF,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:o},e))]}):(0,n.jsx)(aR,{})})})};let aT=()=>{let{ref:e}=(0,b.UO)();return(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(eq.Z,{icon:(0,n.jsx)(eZ.Z,{size:"large",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(c(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})})})})},aR=()=>{let e=(0,R.useRouter)(),{ref:t}=e.query;return(0,n.jsx)(az.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},aF=e=>{let{schema:t,functions:a,selectFunction:s}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,n.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,n.jsx)("h5",{children:t})]}),(0,n.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:a.map(e=>(0,n.jsx)(aA,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:s},e.id))})]})},aA=e=>{let{id:t,completeStatement:a,name:s,onClick:r}=e,[l,i]=(0,d.useState)(!1);return(0,n.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>r(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(ah.Z,{strokeWidth:2,size:14})}),(0,n.jsx)("p",{className:"mb-0 text-sm",children:s})]}),(0,n.jsx)(u.z,{type:"text",onClick:e=>{e.stopPropagation(),i(!l)},icon:(0,n.jsx)(ak.Z,{className:l?"rotate-180 transform":"rotate-0 transform"}),children:l?"Hide definition":"View definition"})]}),(0,n.jsx)(aw.u,{show:l,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,n.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,n.jsx)(aE.Z,{defaultValue:a,readOnly:!0,contextmenu:!1})})})]})};class aD{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,a,n,s,r,l,i,o,c,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(a=null==e?void 0:e.enabled_mode)&&void 0!==a?a:"ORIGIN"},this.events={value:null!==(n=null==e?void 0:e.events)&&void 0!==n?n:[]},this.functionName={value:null!==(s=null==e?void 0:e.function_name)&&void 0!==s?s:""},this.functionSchema={value:null!==(r=null==e?void 0:e.function_schema)&&void 0!==r?r:""},this.orientation={value:null!==(l=null==e?void 0:e.orientation)&&void 0!==l?l:"STATEMENT"},this.name={value:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,t9._)(this,"id",void 0),(0,t9._)(this,"originalName",void 0),(0,t9._)(this,"activation",void 0),(0,t9._)(this,"enabledMode",void 0),(0,t9._)(this,"events",void 0),(0,t9._)(this,"functionName",void 0),(0,t9._)(this,"functionSchema",void 0),(0,t9._)(this,"orientation",void 0),(0,t9._)(this,"name",void 0),(0,t9._)(this,"schema",void 0),(0,t9._)(this,"table",void 0),(0,t9._)(this,"tableId",void 0),(0,al.ky)(this),this.reset()}}class aP{get isEditing(){return void 0!=this.formState.id}constructor(){(0,t9._)(this,"chooseFunctionFormVisible",!1),(0,t9._)(this,"formState",new aD),(0,t9._)(this,"meta",null),(0,t9._)(this,"tables",[]),(0,t9._)(this,"isDirty",!1),(0,t9._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,t9._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,t9._)(this,"setisDirty",e=>{this.isDirty=e}),(0,t9._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!C.F.includes(e.schema)),this.setDefaultSelectedTable()}),(0,t9._)(this,"onFormChange",e=>{let{key:t,value:a}=e;if(this.isDirty=!0,t7()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:a,error:void 0}}else this.formState[t]={value:a}}),(0,t9._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,t9._)(this,"validateForm",()=>{let e=!0,t=at()(this.formState,(t,a)=>{switch(a){case"name":var n;if(eM()(t.value)||(n=t.value,/\s/.test(n)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(eM()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(eM()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(eM()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,al.ky)(this)}}let aq=(0,d.createContext)(null);var aL=(0,ai.Pi)(e=>{let{trigger:t,visible:a,setVisible:s}=e,{project:r}=(0,F.d2)(),[l,i]=(0,d.useState)(!1),o=(0,ai.fv)(()=>new aP);(0,q.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{onSuccess(e){o.tables.length<=0&&o.setTables(e)}});let{data:c}=(0,aj.R)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),u=(null!=c?c:[]).filter(e=>"trigger"===e.return_type),{mutate:m,isLoading:x}=(0,av.x)(),{mutate:h,isLoading:p}=aN();async function f(){if(!r)return console.error("Project is required");if(o.validateForm()){let e=o.formState.requestBody;o.isEditing&&e.id?h({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,payload:e},{onSuccess:()=>{ea.ZP.success("Successfully updated trigger ".concat(e.name)),s(!a)},onError:e=>{ea.ZP.error("Failed to update trigger: ".concat(e.message))}}):m({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,payload:e},{onSuccess:()=>{ea.ZP.success("Successfully created trigger ".concat(e.name)),s(!a)},onError:e=>{ea.ZP.error("Failed to create trigger: ".concat(e.message))}})}}(0,d.useEffect)(()=>{o.setisDirty(!1),t?o.formState.reset(t):(o.formState.reset(),o.setDefaultSelectedTable())},[a,t]);let j=o.tables.length>=1;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(en.ZP,{size:"large",visible:a,onCancel:()=>{o.isDirty?i(!0):s(!a)},header:o.formState.id?"Edit '".concat(o.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!j,className:o.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:x||p,onConfirm:f,children:j?(0,n.jsxs)("div",{children:[(0,n.jsxs)(aq.Provider,{value:o,children:[(0,n.jsx)("div",{className:"my-6 space-y-10",children:o.isEditing?(0,n.jsxs)("div",{className:"space-y-6 px-6",children:[(0,n.jsx)(aV,{}),(0,n.jsx)(aW,{})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(aV,{})}),(0,n.jsx)(en.ZP.Separator,{}),(0,n.jsxs)("div",{className:"space-y-12 px-6",children:[(0,n.jsx)("h5",{children:"Conditions to fire trigger"}),(0,n.jsx)(aY,{}),(0,n.jsx)(aU,{}),(0,n.jsx)(aB,{}),(0,n.jsx)(aO,{})]}),(0,n.jsx)(en.ZP.Separator,{}),(0,n.jsx)(aM,{})]})}),(0,n.jsx)(aI,{triggerFunctions:u,visible:o.chooseFunctionFormVisible,setVisible:o.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=c?c:[]).find(t=>t.id===e);t&&o.onSelectFunction(t)}})]}),(0,n.jsx)(tD.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),s(!a)},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]}):(0,n.jsx)(af.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let aV=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsx)(m.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),aW=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsxs)(e9.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,n.jsxs)(e9.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behavior"})]}),(0,n.jsxs)(e9.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in “replica” mode"})]}),(0,n.jsxs)(e9.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,n.jsxs)(e9.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),aO=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsxs)(e9.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,n.jsxs)(e9.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,n.jsxs)(e9.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),aY=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsx)(e9.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let a=t.tables.find(t=>t.id===e);a&&(t.onFormChange({key:"table",value:a.name}),t.onFormChange({key:"schema",value:a.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,n.jsx)(e9.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(ao.Z,{src:"".concat(tT.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,n.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),aU=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsxs)(ac.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let a=t.formState.events.value,n=e.target.checked?an()(a,[e.target.value]):ar()(a,e.target.value);t.onFormChange({key:"events",value:n})},error:t.formState.events.error,children:[(0,n.jsx)(ac.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,n.jsx)(ac.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,n.jsx)(ac.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),aB=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsxs)(e9.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,n.jsx)(e9.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(ad.Z,{strokeWidth:2,size:"small"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"before"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,n.jsx)(e9.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,n.jsx)(ax,{strokeWidth:2,size:"small"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"after"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),aM=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"space-y-6 px-6",children:(0,n.jsx)("h5",{children:"Function to trigger"})}),(0,n.jsx)("div",{className:"px-6",children:eM()(t.formState.functionName.value)?(0,n.jsx)(aQ,{}):(0,n.jsx)(aH,{})})]})}),aQ=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,n.jsx)(ap,{icon:(0,n.jsx)(ah.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),aH=(0,ai.Pi)(e=>{let{}=e,t=(0,d.useContext)(aq);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,n.jsx)(ah.Z,{size:"small",strokeWidth:2,width:14})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,n.jsx)("div",{children:(0,n.jsx)(X.C,{children:t.formState.functionSchema.value})})]})]}),(0,n.jsx)(u.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var aX=a(34820),aK=a(55825),aG=e=>{let{trigger:t,visible:a,setVisible:s}=e,{project:r}=(0,F.d2)(),{id:l,name:i,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,aK.m)();async function u(){return r?l?void c({projectRef:r.ref,connectionString:r.connectionString,id:l},{onSuccess:()=>{ea.ZP.success("Successfully removed ".concat(i)),s(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,n.jsx)(aX.Z,{variant:"warning",visible:a,onCancel:()=>s(!a),onConfirm:u,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(i),confirmPlaceholder:"Type in name of trigger",confirmString:i,text:(0,n.jsxs)(n.Fragment,{children:["This will delete your trigger called"," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:i})," of schema"," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."}})},aJ=a(87622),a$=a.n(aJ),a0=a(3536),a2=a(55274),a1=a(3641);async function a4(e){let{projectRef:t,connectionString:a,payload:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:r,error:l}=await (0,tX.v_)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:t}},body:n,headers:s});return l&&(0,tX.S3)(l),r}let a3=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>a4(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(a1.l.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to create database function: ".concat(e.message)):t(e,a,n)},...a})};async function a5(e){let{projectRef:t,connectionString:a,id:n,payload:s}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:l,error:i}=await (0,tX.r$)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},body:s,headers:r});return i&&(0,tX.S3)(i),l}let a6=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>a5(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(a1.l.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to update database function: ".concat(e.message)):t(e,a,n)},...a})};var a9=a(7117),a8=a(95392),a7=a(62949),ne=a(19869),nt=a(1309),na=a(87668),nn=a(87062);let ns=e=>{let{selectedFunction:t,assistantVisible:a,setAssistantVisible:s}=e;return(0,n.jsx)(a9.Tu,{className:"py-3 flex flex-row justify-between items-center border-b-0",children:(0,n.jsxs)("div",{className:"flex flex-row gap-3 items-center max-w-[75%]",children:[(0,n.jsxs)(a9.sw,{className:(0,eI.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),children:[(0,n.jsx)(Q.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,n.jsx)(a9.bC,{className:"truncate",children:void 0!==t?"Edit '".concat(t,"' function"):"Add a new function"})]})})};var nr=a(99064),nl=a(25097),ni=a(2322);let no=e=>{let{field:t,focused:a,setFocused:s}=e;return(0,n.jsxs)("div",{className:(0,eI.cn)("rounded-md relative group flex-grow"),children:[(0,n.jsx)(es.NI,{children:(0,n.jsx)(aE.Z,{defaultValue:t.value,onInputChange:e=>{t.onChange(e)},contextmenu:!1})}),(0,n.jsx)("div",{className:(0,eI.cn)("absolute top-0 right-2 bg-surface-300 border border-strong rounded h-[28px]","opacity-0 group-hover:opacity-100 group-hover:top-2 transition-all"),children:(0,n.jsxs)(ni.u,{children:[(0,n.jsx)(ni.aJ,{asChild:!0,children:(0,n.jsx)(u.z,{type:"text",size:"tiny",className:(0,eI.cn)("px-2 text-foreground-lighter hover:text-foreground","transition z-50"),onClick:()=>s(!a),icon:a?(0,n.jsx)(nr.Z,{}):(0,n.jsx)(nl.Z,{})})}),(0,n.jsx)(ni._v,{side:"bottom",children:a?"Minimize editor":"Maximize editor"})]})})]})},nc="create-function-sidepanel",nd=ei.ZP.object({name:ei.ZP.string().trim().min(1),schema:ei.ZP.string().trim().min(1),args:ei.ZP.array(ei.ZP.object({name:ei.ZP.string().trim().min(1),type:ei.ZP.string().trim()})),behavior:ei.ZP.enum(["IMMUTABLE","STABLE","VOLATILE"]),definition:ei.ZP.string().trim().min(1),language:ei.ZP.string().trim(),return_type:ei.ZP.string().trim(),security_definer:ei.ZP.boolean(),config_params:ei.ZP.array(ei.ZP.object({name:ei.ZP.string().trim().min(1),value:ei.ZP.string().trim().min(1)})).optional()});var nu=e=>{let{func:t,visible:a,setVisible:s}=e,{project:r}=(0,F.d2)(),[l,i]=(0,d.useState)(!1),[o,c]=(0,d.useState)(!1),[m,x]=(0,d.useState)(!1),[h,p]=(0,d.useState)(!1),f=!!(null==t?void 0:t.id),j=(0,et.cI)({resolver:(0,ee.F)(nd)}),{mutate:v,isLoading:b}=a3(),{mutate:g,isLoading:y}=a6();function N(){j.formState.isDirty?i(!0):s(!a)}let w=async e=>{if(!r)return console.error("Project is required");let n={...e,args:e.args.map(e=>"".concat(e.name," ").concat(e.type)),config_params:at()(a$()(e.config_params,"name"),"value")};f?g({id:t.id,projectRef:r.ref,connectionString:r.connectionString,payload:n},{onSuccess:()=>{ea.ZP.success("Successfully updated function ".concat(e.name)),s(!a)}}):v({projectRef:r.ref,connectionString:r.connectionString,payload:n},{onSuccess:()=>{ea.ZP.success("Successfully created function ".concat(e.name)),s(!a)}})};return(0,d.useEffect)(()=>{if(a){var e,n,s,r,l,i,o;j.reset({name:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",schema:null!==(n=null==t?void 0:t.schema)&&void 0!==n?n:"public",args:(0,nn.cK)((null==t?void 0:t.argument_types)||"").value,behavior:null!==(s=null==t?void 0:t.behavior)&&void 0!==s?s:"VOLATILE",definition:null!==(r=null==t?void 0:t.definition)&&void 0!==r?r:"",language:null!==(l=null==t?void 0:t.language)&&void 0!==l?l:"plpgsql",return_type:null!==(i=null==t?void 0:t.return_type)&&void 0!==i?i:"void",security_definer:null!==(o=null==t?void 0:t.security_definer)&&void 0!==o&&o,config_params:(0,nn.QI)(null==t?void 0:t.config_params).value})}},[a,t]),(0,n.jsx)(a9.yo,{open:a,onOpenChange:()=>N(),children:(0,n.jsxs)(a9.ue,{showClose:!1,size:m?"lg":"default",className:(0,eI.cn)("p-0 flex flex-row gap-0",m?"!min-w-[1200px]":"!min-w-[600px]"),children:[(0,n.jsxs)("div",{className:(0,eI.cn)("flex flex-col grow w-full",m&&"w-[60%]"),children:[(0,n.jsx)(ns,{selectedFunction:null==t?void 0:t.name,assistantVisible:m,setAssistantVisible:x}),(0,n.jsx)(a8.Z,{}),(0,n.jsx)(es.l0,{...j,children:(0,n.jsxs)("form",{id:nc,className:"flex-grow overflow-auto",onSubmit:j.handleSubmit(w),children:[(0,n.jsx)(a9.DN,{className:h?"hidden":"",children:(0,n.jsx)(es.Wi,{control:j.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsx)(na.E,{label:"Name of function",description:"Name will also be used for the function name in postgres",layout:"horizontal",children:(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t})})})}})}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),(0,n.jsxs)(a9.DN,{className:h?"hidden":"space-y-4",children:[(0,n.jsx)(es.Wi,{control:j.control,name:"schema",render:e=>{let{field:t}=e;return(0,n.jsx)(na.E,{label:"Schema",description:"Tables made in the table editor will be in 'public'",layout:"horizontal",children:(0,n.jsx)(es.NI,{children:(0,n.jsx)(A.Z,{selectedSchemaName:t.value,excludedSchemas:C.F,size:"small",onSelectSchema:e=>t.onChange(e)})})})}}),!f&&(0,n.jsx)(es.Wi,{control:j.control,name:"return_type",render:e=>{let{field:t}=e;return(0,n.jsx)(na.E,{label:"Return type",layout:"horizontal",children:(0,n.jsxs)(a7.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,n.jsx)(a7.i4,{className:"col-span-8",children:(0,n.jsx)(a7.ki,{})}),(0,n.jsx)(a7.Bw,{children:(0,n.jsx)(ne.x,{className:"h-52",children:["void","record","trigger","integer",...a2.DL].map(e=>(0,n.jsx)(a7.Ql,{value:e,children:e},e))})})]})})}})]}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),(0,n.jsx)(a9.DN,{className:h?"hidden":"",children:(0,n.jsx)(nm,{readonly:f})}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),(0,n.jsx)(a9.DN,{className:"".concat(h?"h-full":""," !px-0"),children:(0,n.jsx)(es.Wi,{control:j.control,name:"definition",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{className:"space-y-4 flex flex-col h-full",children:[(0,n.jsxs)("div",{className:"px-content",children:[(0,n.jsx)(es.lX,{className:"text-base text-foreground",children:"Definition"}),(0,n.jsxs)(es.pf,{className:"text-sm text-foreground-light",children:[(0,n.jsxs)("p",{children:["The language below should be written in"," ",(0,n.jsx)("code",{children:(0,n.jsx)(nf,{})}),"."]}),!f&&(0,n.jsx)("p",{children:"Change the language in the Advanced Settings below."})]})]}),(0,n.jsx)("div",{className:(0,eI.cn)("border border-default flex",h?"flex-grow ":"h-72"),children:(0,n.jsx)(no,{field:t,focused:h,setFocused:p})}),(0,n.jsx)(es.zG,{className:"px-content"})]})}})}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),f?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a9.DN,{className:h?"hidden":"",children:(0,n.jsx)("div",{className:"space-y-8 rounded bg-studio py-4 px-6 border border-overlay",children:(0,n.jsx)(eC.Z,{onChange:()=>c(!o),label:"Show advanced settings",checked:o,labelOptional:"These are settings that might be familiar for Postgres developers"})})}),o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a9.DN,{className:h?"hidden":"space-y-2 pt-0",children:[(0,n.jsx)(np,{}),(0,n.jsx)(es.Wi,{control:j.control,name:"behavior",render:e=>{let{field:t}=e;return(0,n.jsx)(na.E,{label:"Behavior",layout:"horizontal",children:(0,n.jsxs)(a7.Ph,{defaultValue:t.value,onValueChange:t.onChange,children:[(0,n.jsx)(a7.i4,{className:"col-span-8",children:(0,n.jsx)(a7.ki,{})}),(0,n.jsxs)(a7.Bw,{children:[(0,n.jsx)(a7.Ql,{value:"IMMUTABLE",children:"immutable"},"IMMUTABLE"),(0,n.jsx)(a7.Ql,{value:"STABLE",children:"stable"},"STABLE"),(0,n.jsx)(a7.Ql,{value:"VOLATILE",children:"volatile"},"VOLATILE")]})]})})}})]}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),(0,n.jsx)(a9.DN,{className:h?"hidden":"",children:(0,n.jsx)(nx,{readonly:f})}),(0,n.jsx)(a8.Z,{className:h?"hidden":""}),(0,n.jsxs)(a9.DN,{className:h?"hidden":"",children:[(0,n.jsx)("h5",{className:"text-base text-foreground mb-4",children:"Type of Security"}),(0,n.jsx)(es.Wi,{control:j.control,name:"security_definer",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.NI,{className:"col-span-8",children:(0,n.jsxs)(nt.Z.Group,{type:"cards",layout:"vertical",onChange:e=>t.onChange("SECURITY_DEFINER"==e.target.value),value:t.value?"SECURITY_DEFINER":"SECURITY_INVOKER",children:[(0,n.jsx)(nt.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.value,description:(0,n.jsxs)(n.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,n.jsx)("span",{className:"text-foreground",children:"calls it"}),"."]})}),(0,n.jsx)(nt.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.value,description:(0,n.jsxs)(n.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,n.jsx)("span",{className:"text-foreground",children:"created it"}),"."]})})]})}),(0,n.jsx)(es.zG,{})]})}})]})]})]})]})}),(0,n.jsxs)(a9.FF,{children:[(0,n.jsx)(u.z,{disabled:b||y,type:"default",onClick:N,children:"Cancel"}),(0,n.jsx)(u.z,{form:nc,htmlType:"submit",disabled:b||y,loading:b||y,children:"Confirm"})]})]}),m?(0,n.jsx)("div",{className:"border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10 w-[50%] bg-studio"}):null,(0,n.jsx)(tD.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),s(!a)},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})})};let nm=e=>{let{readonly:t}=e,{fields:a,append:s,remove:r}=(0,et.Dq)({name:"args"});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,n.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&eM()(a)&&(0,n.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),a.map((e,a)=>(0,n.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,n.jsx)(es.Wi,{name:"args.".concat(a,".name"),render:e=>{let{field:a}=e;return(0,n.jsxs)(es.xJ,{className:"flex-1",children:[(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...a,disabled:t,placeholder:"argument_name"})}),(0,n.jsx)(es.zG,{})]})}}),(0,n.jsx)(es.Wi,{name:"args.".concat(a,".type"),render:e=>{let{field:a}=e;return(0,n.jsxs)(es.xJ,{className:"flex-1",children:[(0,n.jsx)(es.NI,{children:t?(0,n.jsx)(er.I,{value:a.value,disabled:!0,readOnly:!0,className:"h-auto"}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(a7.Ph,{disabled:t,onValueChange:a.onChange,defaultValue:a.value,children:[(0,n.jsx)(a7.i4,{className:"h-[38px]",children:(0,n.jsx)(a7.ki,{})}),(0,n.jsx)(a7.Bw,{children:(0,n.jsx)(ne.x,{className:"h-52",children:["integer",...a2.DL].map(e=>(0,n.jsx)(a7.Ql,{value:e,children:e},e))})})]})})}),(0,n.jsx)(es.zG,{})]})}}),!t&&(0,n.jsx)(u.z,{type:"danger",icon:(0,n.jsx)(a0.Z,{size:12}),onClick:()=>r(a),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(H.Z,{size:12}),onClick:()=>s({name:"",type:"integer"}),disabled:t,children:"Add a new argument"})]})]})},nx=e=>{let{readonly:t}=e,{fields:a,append:s,remove:r}=(0,et.Dq)({name:"config_params"});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Configuration Parameters"}),(0,n.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&eM()(a)&&(0,n.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),a.map((e,a)=>(0,n.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,n.jsx)(es.Wi,{name:"config_params.".concat(a,".name"),render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{className:"flex-1",children:[(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t,placeholder:"parameter_name"})}),(0,n.jsx)(es.zG,{})]})}}),(0,n.jsx)(es.Wi,{name:"config_params.".concat(a,".value"),render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{className:"flex-1",children:[(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t,placeholder:"parameter_value"})}),(0,n.jsx)(es.zG,{})]})}}),!t&&(0,n.jsx)(u.z,{type:"danger",icon:(0,n.jsx)(a0.Z,{size:12}),onClick:()=>r(a),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(H.Z,{size:12}),onClick:()=>s({name:"",type:""}),disabled:t,children:"Add a new config"})]})]})},nh=["plpgsql","sql","plcoffee","plv8","plls"],np=()=>{let{project:e}=(0,F.d2)(),{data:t}=(0,eL.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString},{select:e=>I()(e,e=>!eA()(e.installed_version))[0]}),a=(0,d.useMemo)(()=>nh.filter(e=>!e.startsWith("pl")||(null==t?void 0:t.find(t=>t.name===e))!==void 0),[t]);return(0,n.jsx)(es.Wi,{name:"language",render:e=>{let{field:t}=e;return(0,n.jsx)(na.E,{label:"Language",layout:"horizontal",children:(0,n.jsxs)(a7.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,n.jsx)(a7.i4,{className:"col-span-8",children:(0,n.jsx)(a7.ki,{})}),(0,n.jsx)(a7.Bw,{children:a.map(e=>(0,n.jsx)(a7.Ql,{value:e,children:e},e))})]})})}})},nf=()=>(0,et.qo)({name:"language"});async function nj(e){let{projectRef:t,connectionString:a,id:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:r,error:l}=await (0,tX.IV)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},headers:s});return l&&(0,tX.S3)(l),r}let nv=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>nj(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(a1.l.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.Am.error("Failed to delete database function: ".concat(e.message)):t(e,a,n)},...a})};var nb=e=>{let{func:t,visible:a,setVisible:s}=e,{project:r}=(0,F.d2)(),{id:l,name:i,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=nv({onSuccess:()=>{ea.ZP.success("Successfully removed function ".concat(i)),s(!1)}});async function u(){return l?r?void c({id:l,projectRef:r.ref,connectionString:r.connectionString}):console.error("Project is required"):console.error("Function ID is require")}return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(aX.Z,{variant:"warning",visible:a,onCancel:()=>s(!a),onConfirm:u,title:"Delete this function",loading:d,confirmLabel:"Delete function ".concat(i),confirmPlaceholder:"Type in name of function",confirmString:i,text:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"This will delete the function"})," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:i})," ",(0,n.jsx)("span",{children:"from the schema"})," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this function once deleted."}})})},ng=a(42679),ny=a(65644),nN=a(4573),nw=a(40023),n_=a(95492),nS=a(60942);async function nC(e){let{projectRef:t,connectionString:a,schema:n,name:s,description:r,values:l}=e,i='create type "'.concat(n,'"."').concat(s,'" as enum (').concat(l.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==r?'comment on type "'.concat(n,'"."').concat(s,"\" is '").concat(r,"';"):"",c=eX("".concat(i," ").concat(o)),{result:d}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:c});return d}let nZ=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>nC(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nS.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nk=a(62221),nz=e=>{let{index:t,id:a,field:s,isDisabled:r=!1,onRemoveValue:l}=e;return(0,n.jsx)(nw._l,{draggableId:a,index:t,isDragDisabled:r,children:e=>(0,n.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2 space-y-2",children:[(0,n.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(r?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,n.jsx)(nk.Z,{size:16,strokeWidth:1.5})}),(0,n.jsx)(er.I,{...s,className:"w-full"}),(0,n.jsx)(u.z,{type:"default",size:"small",disabled:r,icon:(0,n.jsx)(v.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>l()})]})})};let nE=[...a2.ji,...a2.BB,...a2.YF,...a2.Ks,...a2.XO,...a2.lb,...a2.vH,"bigint","bigserial","bit","bit varying","boolean","box","bytea","char","character","character varying","cidr","circle","date","double precision","inet","int","integer","interval","line","lseg","macaddr","macaddr8","money","numeric","decimal","path","pg_lsn","pg_snapshot","point","polygon","real","smallint","smallserial","serial","time with timezone","timestamp with timezone","tsquery","tsvector","txid_snapshot","xml"];var nI=e=>{let{visible:t,onClose:a,schema:s}=e,r={name:"",description:"",values:[{value:""}]},l=(0,d.useRef)(null),{project:i}=(0,F.d2)(),{mutate:o,isLoading:m}=nZ({onSuccess:(e,t)=>{ea.ZP.success('Successfully created type "'.concat(t.name,'"')),y()}});(0,d.useEffect)(()=>{p.reset(r)},[t]);let x=ei.Ry({name:ei.Z_().min(1,"Please provide a name for your enumerated type").refine(e=>!nE.includes(e),{message:"Name cannot be a native Postgres data type"}).default(""),description:ei.Z_().default("").optional(),values:ei.Ry({value:ei.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,et.cI)({resolver:(0,ee.F)(x),defaultValues:r}),{fields:f,append:j,remove:v,move:b}=(0,et.Dq)({name:"values",control:p.control}),g=e=>{e.destination&&b(e.source.index,e.destination.index)},y=()=>{p.reset(r),a()};return(0,n.jsx)(en.ZP,{loading:m,visible:t,onCancel:y,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{l.current&&l.current.click()},children:(0,n.jsx)(en.ZP.Content,{className:"py-4",children:(0,n.jsx)(es.l0,{...p,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(e=>{var t;return(null==i?void 0:i.ref)===void 0?console.error("Project ref required"):(null==i?void 0:i.connectionString)===void 0?console.error("Project connectionString required"):void o({projectRef:i.ref,connectionString:i.connectionString,schema:s,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value.trim())})}),children:[(0,n.jsx)(es.Wi,{control:p.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{children:"Name"}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t})}),(0,n.jsx)(es.zG,{})]})}}),(0,n.jsx)(es.Wi,{control:p.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{children:"Description"}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t})}),(0,n.jsx)(es.pf,{children:"Optional"})]})}}),(0,n.jsx)(nw.Z5,{onDragEnd:e=>g(e),children:(0,n.jsx)(nw.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[f.map((e,t)=>(0,n.jsx)(es.Wi,{control:p.control,name:"values.".concat(t,".value"),render:a=>{let{field:s}=a;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{className:(0,eI.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(n_.bZ,{children:[(0,n.jsx)(eD.Z,{strokeWidth:1.5}),(0,n.jsx)(n_.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,n.jsxs)(n_.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eP.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(c(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(nz,{index:t,id:e.id,field:s,isDisabled:f.length<2,onRemoveValue:()=>v(t)})}),(0,n.jsx)(es.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(h.Z,{strokeWidth:1.5}),onClick:()=>j({value:""}),children:"Add value"}),(0,n.jsx)(u.z,{ref:l,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})};async function nT(e){let{projectRef:t,connectionString:a,name:n,schema:s}=e,r="drop type if exists ".concat(s,'."').concat(n,'"'),{result:l}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:r});return l}let nR=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>nT(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nS.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nF=e=>{let{visible:t,selectedEnumeratedType:a,onClose:s}=e,{project:r}=(0,F.d2)(),{mutate:l,isLoading:i}=nR({onSuccess:()=>{ea.ZP.success('Successfully deleted "'.concat(a.name,'"')),s()}}),o=()=>void 0===a?console.error("No enumerated type selected"):(null==r?void 0:r.ref)===void 0?console.error("Project ref required"):(null==r?void 0:r.connectionString)===void 0?console.error("Project connectionString required"):void l({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,name:a.name,schema:a.schema});return(0,n.jsxs)(tD.Z,{variant:"destructive",size:"medium",loading:i,visible:t,title:(0,n.jsxs)(n.Fragment,{children:["Confirm to delete enumerated type"," ",(0,n.jsx)("code",{className:"text-sm",children:null==a?void 0:a.name})]}),confirmLabel:"Confirm delete",confirmLabelLoading:"Deleting...",onCancel:s,onConfirm:()=>o(),alert:{title:"This action cannot be undone",description:"You will need to re-create the enumerated type if you want to revert the deletion."},children:[(0,n.jsx)("p",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,n.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,n.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})};async function nA(e){let{projectRef:t,connectionString:a,schema:n,name:s,description:r,values:l=[]}=e,i=[];s.original!==s.updated&&i.push('alter type "'.concat(n,'"."').concat(s.original,'" rename to "').concat(s.updated,'";')),l.length>0&&l.forEach((e,t)=>{if(e.isNew){if(0===t){let t=l.find(e=>!e.isNew);i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' after '").concat(l[t-1].updated,"';"))}else e.original!==e.updated&&i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==r&&i.push('comment on type "'.concat(n,'"."').concat(s.updated,"\" is '").concat(r,"';"));let o=eX(i.join(" ")),{result:c}=await (0,em.Rj)({projectRef:t,connectionString:a,sql:o});return c}let nD=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ec.NL)();return(0,ed.D)(e=>nA(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nS.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?ea.ZP.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nP=e=>{var t;let{visible:a,selectedEnumeratedType:s,onClose:r}=e,l=(0,d.useRef)(null),{project:i}=(0,F.d2)(),{mutate:o,isLoading:m}=nD({onSuccess:(e,t)=>{ea.ZP.success('Successfully updated type "'.concat(t.name.updated,'"')),r()}}),x=ei.Ry({name:ei.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:ei.Z_().default("").optional(),values:ei.Ry({isNew:ei.O7(),originalValue:ei.Z_(),updatedValue:ei.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,et.cI)({resolver:(0,ee.F)(x),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:f,append:j,remove:v,move:b}=(0,et.Dq)({name:"values",control:p.control}),g=e=>{e.destination&&b(e.source.index,e.destination.index)},y=(null!==(t=null==s?void 0:s.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,d.useEffect)(()=>{if(void 0!==s){var e;p.reset({name:s.name,description:null!==(e=s.comment)&&void 0!==e?e:"",values:y})}void 0==s&&p.reset({values:y})},[s]),(0,n.jsx)(en.ZP,{loading:m,visible:a,onCancel:r,header:'Update type "'.concat(null==s?void 0:s.name,'"'),confirmText:"Update type",onConfirm:()=>{l.current&&l.current.click()},children:(0,n.jsx)(en.ZP.Content,{className:"py-4",children:(0,n.jsx)(es.l0,{...p,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(e=>{var t;if((null==i?void 0:i.ref)===void 0)return console.error("Project ref required");if((null==i?void 0:i.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===s)return console.error("selectedEnumeratedType required");let a={schema:s.schema,name:{original:s.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue.trim(),isNew:e.isNew})),...e.description!==s.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:i.ref,connectionString:i.connectionString,...a})}),children:[(0,n.jsx)(es.Wi,{control:p.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{children:"Name"}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t})}),(0,n.jsx)(es.zG,{})]})}}),(0,n.jsx)(es.Wi,{control:p.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{children:"Description"}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(er.I,{...t})}),(0,n.jsx)(es.pf,{children:"Optional"})]})}}),(0,n.jsx)(nw.Z5,{onDragEnd:e=>g(e),children:(0,n.jsx)(nw.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[f.map((e,t)=>(0,n.jsx)(es.Wi,{control:p.control,name:"values.".concat(t,".updatedValue"),render:a=>{let{field:s}=a;return(0,n.jsxs)(es.xJ,{children:[(0,n.jsx)(es.lX,{className:(0,eI.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(n_.bZ,{children:[(0,n.jsx)(eD.Z,{strokeWidth:1.5}),(0,n.jsx)(n_.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,n.jsxs)(n_.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eP.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(c(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)(es.NI,{children:(0,n.jsx)(nz,{index:t,id:e.id,field:s,isDisabled:!e.isNew,onRemoveValue:()=>v(t)})}),(0,n.jsx)(es.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(h.Z,{strokeWidth:1.5}),onClick:()=>j({isNew:!0,originalValue:"",updatedValue:""}),children:"Add value"}),(0,n.jsx)(u.z,{ref:l,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},nq=()=>{let{project:e}=(0,F.d2)(),[t,a]=(0,d.useState)(""),[s,r]=(0,d.useState)("public"),[l,i]=(0,d.useState)(!1),[o,c]=(0,d.useState)(),[x,h]=(0,d.useState)(),{data:f}=(0,P.Q)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:j,error:v,isLoading:b,isError:g,isSuccess:_}=(0,nN.k)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),S=(null!=j?j:[]).filter(e=>e.enums.length>0),Z=t.length>0?S.filter(e=>e.schema===s&&e.name.toLowerCase().includes(t.toLowerCase())):S.filter(e=>e.schema===s),z=(null!=f?f:[]).filter(e=>{var t;return C.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),E=null==f?void 0:f.find(e=>e.name===s),I=z.some(e=>e.id===(null==E?void 0:E.id));return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(A.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:s,onSelectSchema:r}),(0,n.jsx)(m.Z,{size:"small",value:t,className:"w-64",onChange:e=>a(e.target.value),placeholder:"Search for a type",icon:(0,n.jsx)(M.Z,{size:14})})]}),!I&&(0,n.jsx)(u.z,{type:"primary",onClick:()=>i(!0),children:"Create type"})]}),I&&(0,n.jsx)(k.Z,{schema:s,entity:"enumerated types"}),b&&(0,n.jsx)(w.A,{}),g&&(0,n.jsx)(N.Z,{error:v,subject:"Failed to retrieve database enumerated types"}),_&&(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Schema"},"schema"),(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{children:"Values"},"values"),(0,n.jsx)(y.Z.th,{},"actions")],body:(0,n.jsxs)(n.Fragment,{children:[0===Z.length&&0===t.length&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',s,'"']})]})}),0===Z.length&&t.length>0&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),Z.length>0&&Z.map(e=>(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{className:"w-20",children:(0,n.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,n.jsx)(y.Z.td,{children:e.name}),(0,n.jsx)(y.Z.td,{children:e.enums.join(", ")}),(0,n.jsx)(y.Z.td,{children:!I&&(0,n.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(ng.Z,{})})}),(0,n.jsxs)(p.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsxs)(p.Xi,{className:"space-x-2",onClick:()=>c(e),children:[(0,n.jsx)(ny.Z,{size:14}),(0,n.jsx)("p",{children:"Update type"})]}),(0,n.jsxs)(p.Xi,{className:"space-x-2",onClick:()=>h(e),children:[(0,n.jsx)(a0.Z,{size:14}),(0,n.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,n.jsx)(nI,{visible:l,onClose:()=>i(!1),schema:s}),(0,n.jsx)(nP,{visible:void 0!==o,selectedEnumeratedType:o,onClose:()=>c(void 0)}),(0,n.jsx)(nF,{visible:void 0!==x,selectedEnumeratedType:x,onClose:()=>h(void 0)})]})}},39771:function(e,t,a){var n=a(52322),s=a(34291),r=a.n(s),l=a(2784),i=a(32079);t.Z=e=>{let{loading:t=!1,disableApply:a=!1,hideApply:s=!1,children:o,applyButtonLabel:c="Apply",backButtonLabel:d="Back",applyFunction:u,closePanel:m=r(),formId:x}=e,[h,p]=(0,l.useState)(!1),f=()=>new Promise(e=>u(e)),j=async()=>{p(!0),await f(),p(!1)};return(0,n.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,n.jsx)(i.z,{type:"default",htmlType:"button",onClick:m,disabled:h||t,children:d}),o,void 0!==u?(0,n.jsx)(i.z,{onClick:j,disabled:a||h||t,loading:h||t,children:c}):s?(0,n.jsx)("div",{}):(0,n.jsx)(i.z,{disabled:t||a,loading:t,"data-testid":"action-bar-save-row",htmlType:"submit",form:x,children:c})]})}},96694:function(e,t,a){a.d(t,{Z:function(){return S}});var n=a(52322),s=a(24990),r=a(34291),l=a.n(r),i=a(39097),o=a.n(i);a(2784);var c=a(83178),d=a(2515),u=function(e){return(0,n.jsx)(d.Z,{icon:c.Z,...e})},m=a(59629),x=a(26445),h=function(e){return(0,n.jsx)(d.Z,{icon:x.Z,...e})},p=a(99311),f=function(e){return(0,n.jsx)(d.Z,{icon:p.Z,...e})},j=a(2687),v=a(750),b=a(62284),g=a(48869),y=a(32079),N=a(32830),w=a(55274),_=a(81604),S=e=>{var t,a,r,i;let{value:c,enumTypes:d=[],className:x,size:p="medium",layout:S,error:C,disabled:Z=!1,showLabel:k=!0,description:z,showRecommendation:E=!1,onOptionSelect:I=l()}=e,T=w.DL.concat(d.map(e=>e.name)),R=!c||T.includes(c),F=w.VP[c],A=e=>{switch(e){case"number":return(0,n.jsx)(u,{size:16,className:"text-foreground",strokeWidth:1.5});case"time":return(0,n.jsx)(m.Z,{size:16,className:"text-foreground",strokeWidth:1.5});case"text":return(0,n.jsx)(h,{size:16,className:"text-foreground",strokeWidth:1.5});case"json":return(0,n.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,n.jsx)(f,{size:16,className:"text-foreground",strokeWidth:1.5});default:return(0,n.jsx)(j.Z,{size:16,className:"text-foreground p-0.5",strokeWidth:1.5})}};return R?Z&&!k?(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{children:(0,n.jsx)(v.Z,{readOnly:!0,disabled:!0,label:k?"Type":"",layout:k?"horizontal":void 0,className:"md:gap-x-0",size:"small",icon:A(null!==(i=null===(r=w.N0.find(e=>e.name===c))||void 0===r?void 0:r.type)&&void 0!==i?i:""),value:c})}),!k&&z&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[240px]",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:z})})]})})]}):(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(b.Z,{label:k?"Type":"",layout:S||(k?"horizontal":"vertical"),value:c,size:p,error:C,disabled:Z,descriptionText:z,className:"".concat(x," ").concat(Z?"column-type-disabled":""," rounded-md"),onChange:e=>I(e),optionsWidth:480,children:[(0,n.jsx)(b.Z.Option,{value:"",label:"---",children:"---"},"empty"),d.length>0?(0,n.jsx)(b.Z.Option,{disabled:!0,value:"header-1",label:"header-1",children:"Other Data Types"},"header-1"):(0,n.jsx)(n.Fragment,{}),d.length>0?d.map(e=>(0,n.jsx)(b.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>(0,n.jsx)(_.Z,{size:16,className:"text-foreground",strokeWidth:1.5}),children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("p",{className:"text-foreground",children:e.name}),void 0!==e.comment&&(0,n.jsx)("p",{className:"text-foreground-lighter",children:e.comment})]})},e.name)):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(b.Z.Option,{disabled:!0,value:"header-2",label:"header-2",children:"PostgreSQL Data Types"}),w.N0.map(e=>(0,n.jsx)(b.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>A(e.type),children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("span",{className:"text-foreground",children:e.name}),(0,n.jsx)("span",{className:"text-foreground-lighter",children:e.description})]})},e.name))]}),E&&void 0!==F&&(0,n.jsxs)(g.b,{withIcon:!0,variant:"warning",title:(0,n.jsxs)(n.Fragment,{children:["It is recommended to use ",(0,n.jsx)("code",{className:"text-xs",children:F.alternative})," ","instead"]}),children:[(0,n.jsxs)("p",{children:["Postgres recommends against using the data type ",(0,n.jsx)("code",{className:"text-xs",children:c})," ","unless you have a very specific use case."]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,n.jsx)(y.z,{asChild:!0,type:"default",icon:(0,n.jsx)(N.Z,{}),children:(0,n.jsx)(o(),{href:F.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,n.jsxs)(y.z,{type:"primary",onClick:()=>I(F.alternative),children:["Use ",F.alternative]})]})]})]}):(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{children:(0,n.jsx)(v.Z,{readOnly:!0,disabled:!0,label:k?"Type":"",layout:k?"horizontal":void 0,className:"md:gap-x-0",size:"small",icon:A(null!==(a=null===(t=w.N0.find(e=>e.name===c))||void 0===t?void 0:t.type)&&void 0!==a?a:""),value:c,descriptionText:k?"Custom non-native psql data types currently cannot be changed to a different data type via Supabase Studio":""})}),!k&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[240px]",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Custom non-native psql data types currently cannot be changed to a different data type via Supabase Studio"})})]})})]})}},14698:function(e,t,a){a.d(t,{iN:function(){return v},ph:function(){return u},by:function(){return j},hj:function(){return x},B4:function(){return f},S0:function(){return h},ld:function(){return s}});var n=a(52322);function s(e){return(0,n.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,n.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,n.jsx)("div",{className:"space-y-20",children:e.children})]})}var r=a(17172),l=a(39097),i=a.n(l),o=a(14048),c=a(80435),d=a(32079);let u=e=>{let{title:t,description:a,docsUrl:s,actions:l,className:u}=e;return(0,n.jsxs)("div",{className:"mb-6 flex items-center justify-between ".concat(u),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl",children:(0,n.jsx)(o.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:t})}),a&&(0,n.jsx)(c.U,{content:a,className:"max-w-full"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==s&&(0,n.jsx)(d.z,{asChild:!0,type:"default",icon:(0,n.jsx)(r.Z,{size:14}),children:(0,n.jsx)(i(),{href:s,target:"_blank",rel:"noreferrer",children:"Documentation"})}),l]})]})};var m=a(2784);let x=e=>{let{children:t,id:a,header:s,disabled:r,className:l}=e;return(0,n.jsxs)("div",{id:a,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(r?" opacity-30":" opacity-100"),"".concat(l)].join(" "),children:[s,t]})},h=e=>{let{children:t,className:a="",description:s}=e;return void 0!==s?(0,n.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(a),children:[(0,n.jsx)("label",{className:"text-foreground text-sm",children:t}),s]}):(0,n.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(a),children:t})},p=()=>(0,n.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,n.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,n.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,n.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]}),f=e=>{let{children:t,loading:a=!0,fullWidth:s,className:r}=e;return(0,n.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(s&&"!col-span-12","\n        ").concat(r,"\n      "),children:a?m.Children.map(t,()=>(0,n.jsx)(p,{})):t})},j=e=>{let{children:t,header:a,footer:s}=e;return(0,n.jsxs)("div",{className:" bg-surface-100 border-default overflow-hidden  rounded-md border shadow",children:[a&&(0,n.jsx)("div",{className:"border-default border-b px-8 py-4",children:a}),(0,n.jsx)("div",{className:"divide-border flex flex-col gap-0 divide-y",children:t}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"border-default border-t"}),s]})]})},v=e=>{let{form:t,hasChanges:a,handleReset:s,helper:r,disabled:l=!1,isSubmitting:i,submitText:o="Save"}=e,c=i||l||!a&&void 0!==a;return(0,n.jsxs)("div",{className:["flex w-full items-center gap-2",r?"justify-between":"justify-end"].join(" "),children:[r&&(0,n.jsx)("span",{className:"text-sm text-foreground-lighter",children:r}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(d.z,{disabled:c,type:"default",htmlType:"reset",onClick:()=>s(),children:"Cancel"}),(0,n.jsx)(d.z,{form:t,type:"primary",htmlType:"submit",disabled:c,loading:i,children:o})]})]})}},89777:function(e,t,a){var n=a(52322),s=a(54383),r=a(32079);t.Z=e=>{let{searchString:t,onResetFilter:a,className:l}=e;return(0,n.jsxs)("div",{className:(0,s.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",l),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==a&&(0,n.jsx)(r.z,{type:"default",onClick:()=>a(),children:"Reset filter"})]})}},7999:function(e,t,a){var n=a(52322),s=a(5632),r=a(62029);t.Z=e=>{let{message:t}=e,a=(0,s.useRouter)(),{ref:l}=a.query;return(0,n.jsx)(r.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{a.push("/project/".concat(l,"/editor"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},22238:function(e,t,a){a.d(t,{k:function(){return d}});var n=a(85945),s=a(48228),r=a(62202),l=a(31696),i=a(18592),o=a(24368);async function c(e){let{projectRef:t,connectionString:a,schema:n,name:s,version:r,cascade:o=!1,createSchema:c=!1}=e,d=new Headers;if(a&&d.set("x-connection-encrypted",a),c)try{await (0,i.Rj)({projectRef:t,connectionString:a,sql:"create schema if not exists ".concat(n)})}catch(e){throw e}let{data:u,error:m}=await (0,l.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:t}},body:{schema:n,name:s,version:r,cascade:o},headers:d});return m&&(0,l.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.o.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,a,n)},...a})}},7509:function(e,t,a){a.d(t,{R:function(){return i}});var n=a(36492),s=a(31696),r=a(3641);async function l(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,s.U2)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:a}},headers:r,signal:t});return i&&(0,s.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.l.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:a},n)},{enabled:s&&void 0!==t,...i})}},3641:function(e,t,a){a.d(t,{l:function(){return n}});let n={list:e=>["projects",e,"database-functions"]}},60028:function(e,t,a){a.d(t,{z:function(){return i}});var n=a(36492),s=a(31696),r=a(74026);async function l(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,s.U2)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:a}},headers:r,signal:t});return i&&(0,s.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.z.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:a},n)},{enabled:s&&void 0!==t,...i})}},26764:function(e,t,a){a.d(t,{u:function(){return c}});var n=a(85945),s=a(48228),r=a(62202),l=a(31696),i=a(74026);async function o(e){let{projectRef:t,connectionString:a,id:n,tables:s,publish_insert:r,publish_update:i,publish_delete:o,publish_truncate:c}=e,d=new Headers;a&&d.set("x-connection-encrypted",a);let u={id:n};void 0!==s&&(u.tables=s),void 0!==r&&(u.publish_insert=r),void 0!==i&&(u.publish_update=i),void 0!==o&&(u.publish_delete=o),void 0!==c&&(u.publish_truncate=c);let{data:m,error:x}=await (0,l.r$)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},body:u,headers:d});return x&&(0,l.S3)(x),m}let c=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(i.z.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to update database publication: ".concat(e.message)):t(e,a,n)},...a})}},74026:function(e,t,a){a.d(t,{z:function(){return n}});let n={list:e=>["projects",e,"database-publications"]}},42002:function(e,t,a){a.d(t,{x:function(){return d}});var n=a(85945),s=a(48228),r=a(62202),l=a(88354),i=a(99248),o=a(39148);async function c(e){let{projectRef:t,connectionString:a,payload:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let r=await (0,l.v_)("".concat(i.T5,"/pg-meta/").concat(t,"/triggers"),n,{headers:Object.fromEntries(s)});if(r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,a,n)},...a})}},55825:function(e,t,a){a.d(t,{m:function(){return d}});var n=a(62202),s=a(85945),r=a(48228),l=a(88354),i=a(99248),o=a(39148);async function c(e){let{id:t,projectRef:a,connectionString:n}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let r=await (0,l.$v)("".concat(i.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),void 0,{headers:Object.fromEntries(s)});if(null==r?void 0:r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,r.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,s){void 0===t?n.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,a,s)},...a})}},39148:function(e,t,a){a.d(t,{D:function(){return n}});let n={list:e=>["projects",e,"database-triggers"],resource:(e,t)=>["projects",e,"resources",t]}},73258:function(e,t,a){a.d(t,{T:function(){return i}});var n=a(36492),s=a(31696),r=a(22329);async function l(e,t){let{projectRef:a}=e;if(!a)throw Error("Project ref is required");let{data:n,error:r}=await (0,s.U2)("/platform/database/{ref}/backups",{params:{path:{ref:a}},signal:t});return r&&(0,s.S3)(r),n}let i=function(e){let{projectRef:t}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.A.backups(t),e=>{let{signal:a}=e;return l({projectRef:t},a)},{enabled:a&&void 0!==t,...s})}},22329:function(e,t,a){a.d(t,{A:function(){return n}});let n={backups:e=>[e,"database","backups"],poolingConfiguration:e=>[e,"database","pooling-configuration"],indexesFromQuery:(e,t)=>["projects",e,"indexes",{query:t}],indexAdvisorFromQuery:(e,t)=>["projects",e,"index-advisor",{query:t}]}},14491:function(e,t,a){a.d(t,{E:function(){return r}});var n=a(18592);let s=()=>"show max_connections",r=function(e){let{projectRef:t,connectionString:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.cp)({projectRef:t,connectionString:a,sql:s(),queryKey:["max-connections"]},{select:e=>({maxConnections:parseInt(e.result[0].max_connections)}),...r})}},4573:function(e,t,a){a.d(t,{k:function(){return i}});var n=a(36492),s=a(31696),r=a(60942);async function l(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,s.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":n},path:{ref:a}},headers:Object.fromEntries(r),signal:t});return i&&(0,s.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.P.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:a},n)},{enabled:s&&void 0!==t,staleTime:0,...i})}},60942:function(e,t,a){a.d(t,{P:function(){return n}});let n={list:e=>["projects",e,"enumerated-types"]}},67208:function(e,t,a){a.d(t,{y:function(){return r}});var n=a(18592);let s=()=>"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",r=function(e){let{projectRef:t,connectionString:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.cp)({projectRef:t,connectionString:a,sql:s(),queryKey:["fdws"]},r)}},16016:function(e,t,a){a.d(t,{H:function(){return n}});let n={list:e=>["projects",e,"pg-sodium-keys"]}},61469:function(e,t,a){a.d(t,{W:function(){return n}});let n={list:e=>["projects",e,"secrets"],getDecryptedValue:(e,t)=>["projects",e,"secrets",t]}},62804:function(e,t,a){a.d(t,{mp:function(){return o},zQ:function(){return c}});var n=a(36492),s=a(7820),r=a(18592),l=a(61469);let i=e=>new s.A().from("decrypted_secrets","vault").select("decrypted_secret").match({id:e}).toSql(),o=async(e,t)=>{let{projectRef:a,connectionString:n,id:s}=e,o=i(s),{result:c}=await (0,r.Rj)({projectRef:a,connectionString:n,sql:o,queryKey:l.W.getDecryptedValue(a,s)},t);return c},c=function(e){let{projectRef:t,connectionString:a,id:s}=e,{enabled:r,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(l.W.getDecryptedValue(t,s),e=>{let{signal:n}=e;return o({projectRef:t,connectionString:a,id:s},n)},{select:e=>e[0].decrypted_secret,enabled:r&&void 0!==t,...i})}},77542:function(e,t,a){a.d(t,{f:function(){return i}});var n=a(7820),s=a(18592),r=a(61469);let l=()=>new n.A().from("secrets","vault").select("id,name,description,secret,key_id,created_at,updated_at").toSql(),i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.cp)({projectRef:t,connectionString:a,sql:l(),queryKey:r.W.list(t)},{select:e=>e.result,enabled:n&&void 0!==t,...i})}},59629:function(e,t,a){var n=a(52322);a(2784);var s=a(78046),r=a(2515);t.Z=function(e){return(0,n.jsx)(r.Z,{icon:s.Z,...e})}},4361:function(e,t,a){var n=a(52322);a(2784);var s=a(58951),r=a(2515);t.Z=function(e){return(0,n.jsx)(r.Z,{icon:s.Z,...e})}},82796:function(e,t,a){var n=a(52322);a(2784);var s=a(79550),r=a(2515);t.Z=function(e){return(0,n.jsx)(r.Z,{icon:s.Z,...e})}},7117:function(e,t,a){a.d(t,{DN:function(){return j},FF:function(){return v},Tu:function(){return f},bC:function(){return b},sw:function(){return d},ue:function(){return p},yo:function(){return c}});var n=a(52322),s=a(70241),r=a(10929),l=a(2784),i=a(8609),o=a(54383);let c=s.fC;s.xz;let d=s.x8,u=(0,r.j)("fixed inset-0 z-40 flex",{variants:{side:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{side:"right"}}),m=e=>{let{side:t,children:a,...r}=e;return(0,n.jsx)(s.h_,{...r,children:(0,n.jsx)("div",{className:u({side:t}),children:a})})};m.displayName=s.h_.displayName;let x=l.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,n.jsx)(s.aV,{className:(0,o.cn)("fixed inset-0 z-40 bg-alternative/90 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",a),...l,ref:t})});x.displayName=s.aV.displayName;let h=(0,r.j)("fixed z-40 scale-100 gap-4 bg-studio opacity-100 shadow-lg",{variants:{side:{top:"animate-in slide-in-from-top w-full duration-300 border-b",bottom:"animate-in slide-in-from-bottom w-full duration-300 border-t",left:"animate-in slide-in-from-left h-full duration-300 border-r",right:"animate-in slide-in-from-right h-full duration-300 border-l"},size:{content:"",default:"",sm:"",lg:"",xl:"",xxl:"",full:""}},compoundVariants:[{side:["top","bottom"],size:"content",class:"max-h-screen"},{side:["top","bottom"],size:"default",class:"h-1/3"},{side:["top","bottom"],size:"sm",class:"h-1/4"},{side:["top","bottom"],size:"lg",class:"h-1/2"},{side:["top","bottom"],size:"xl",class:"h-5/6"},{side:["top","bottom"],size:"full",class:"h-screen"},{side:["right","left"],size:"content",class:"max-w-screen"},{side:["right","left"],size:"default",class:"w-1/3"},{side:["right","left"],size:"sm",class:"w-1/4"},{side:["right","left"],size:"lg",class:"w-1/2"},{side:["right","left"],size:"xl",class:"w-4/6"},{side:["right","left"],size:"xxl",class:"w-5/6"},{side:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{side:"right",size:"default"}}),p=l.forwardRef((e,t)=>{let{side:a,size:r,className:l,children:c,showClose:d=!0,...u}=e;return(0,n.jsxs)(m,{side:a,children:[(0,n.jsx)(x,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,o.cn)(h({side:a,size:r}),l),...u,children:[c,d?(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,n.jsx)(i.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]}):null]})]})});p.displayName=s.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-5 py-4 text-center sm:text-left border-b",t),...a})};f.displayName="SheetHeader";let j=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-content py-content",t),...a})};j.displayName="SheetSection";let v=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-5 py-3 border-t w-full","flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};v.displayName="SheetFooter";let b=l.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-base text-foreground",a),...r})});b.displayName=s.Dx.displayName,l.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-foreground-muted",a),...r})}).displayName=s.dk.displayName},93705:function(e,t,a){a.d(t,{r:function(){return d}});var n=a(52322),s=a(16530),r=a(10929),l=a(2784),i=a(54383);let o=(0,r.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),c=(0,r.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=l.forwardRef((e,t)=>{let{className:a,size:r,...l}=e;return(0,n.jsx)(s.fC,{className:(0,i.cn)(o({size:r}),a),...l,ref:t,children:(0,n.jsx)(s.bU,{className:(0,i.cn)(c({size:r}))})})});d.displayName=s.fC.displayName}}]);