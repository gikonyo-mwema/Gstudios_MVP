(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6526],{50893:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return s(80122)}])},17635:function(e,t,s){"use strict";var a=s(52322),i=s(47852),n=s(32079),l=s(39097),r=s.n(l),o=s(13710),c=s(14528);t.Z=e=>{let{show:t,setShowUpgradePrompt:s}=e,l=(0,c.lL)();return(0,a.jsx)(i.C,{hideFooter:!0,visible:t,closable:!0,size:"medium",header:"Log retention",onCancel:()=>s(!1),children:(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(i.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,a.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,a.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,a.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,a.jsxs)("div",{className:"py-1",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.FREE.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.PRO.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.TEAM.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.ENTERPRISE.text})]})]})]})]})}),(0,a.jsx)(i.C.Separator,{}),(0,a.jsx)(i.C.Content,{children:(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)(n.z,{type:"default",onClick:()=>s(!1),children:"Close"}),(0,a.jsx)(n.z,{asChild:!0,size:"tiny",children:(0,a.jsx)(r(),{href:"/org/".concat(null==l?void 0:l.slug,"/billing?panel=subscriptionPlan"),children:"Upgrade"})})]})})]})})}},51303:function(e,t,s){"use strict";var a=s(52322);t.Z=e=>{let{children:t,active:s,className:i}=e;return(0,a.jsx)("div",{className:[i,"flex h-full flex-grow transition-opacity ",s?"opacity-30":"opacity-100"].join(" "),children:t})}},18136:function(e,t,s){"use strict";var a=s(36492),i=s(2784),n=s(13710),l=s(88354),r=s(99248);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=(0,n.PJ)(n.up),[o,c]=(0,i.useState)({sql:(null==t?void 0:t.sql)||"",project:e,iso_timestamp_start:t.iso_timestamp_start?t.iso_timestamp_start:s.calcFrom(),iso_timestamp_end:t.iso_timestamp_end?t.iso_timestamp_end:s.calcTo()}),d=void 0!==e&&!!o.sql,m=(0,n.GT)(o),{data:u,error:p,isLoading:x,isRefetching:h,refetch:f}=(0,a.a)(["projects",e,"logs",m],t=>{let{signal:s}=t;return(0,l.U2)("".concat(r.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(m),{signal:s})},{enabled:d,refetchOnWindowFocus:!1}),g=p?p.message:null;return!g&&(null==u?void 0:u.error)&&(g=null==u?void 0:u.error),{params:o,isLoading:d&&x||h,logData:(0,l.d8)(u)&&u.result?u.result:[],error:g,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(t=>({...t,sql:e}))},runQuery:()=>f(),setParams:c}}},94422:function(e,t,s){"use strict";s.d(t,{_:function(){return r}});var a=s(2784),i=s(13710),n=s(93463),l=s(89823);let r=e=>{var t;let s=(0,l.l)(),{data:r}=(0,n.G)({orgSlug:null==s?void 0:s.slug}),[o,c]=(0,a.useState)(!1),d=(0,i.dP)(e,null==r?void 0:null===(t=r.plan)||void 0===t?void 0:t.id);return(0,a.useEffect)(()=>{d&&c(!0)},[e]),{showUpgradePrompt:o,setShowUpgradePrompt:c,shouldShowUpgradePrompt:d}}},80122:function(e,t,s){"use strict";s.r(t),s.d(t,{LogsExplorerPage:function(){return E}});var a=s(52322),i=s(66760),n=s(28879),l=s.n(n),r=s(5632),o=s(2784),c=s(62202),d=s(79983),m=s(47852),u=s(62277),p=s(750),x=s(32079),h=s(13710),f=s(17635),g=s(7929),j=s(64703),v=s(51303),_=s(33706),y=s(79044),N=s(93463),S=s(14528),w=s(18136),b=s(94422),q=s(99248),C=s(82667);let E=()=>{(0,h.Q9)();let e=(0,r.useRouter)(),{ref:t,q:s,ite:n,its:g}=(0,i.UO)(),E=(0,S.lL)(),[P,T]=(0,o.useState)((0,C.k$)()),[L,z]=(0,o.useState)("select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5"),[Z,R]=(0,o.useState)(!1),[k,O]=(0,o.useState)([]),{data:F}=(0,N.G)({orgSlug:null==E?void 0:E.slug}),{params:I,logData:$,error:U,isLoading:D,changeQuery:G,runQuery:V,setParams:A}=(0,w.Z)(t,{iso_timestamp_start:g||void 0,iso_timestamp_end:n||void 0}),[M,Q]=(0,S._)("project-content-".concat(t,"-recent-log-sql"),[]),X=e=>{Q([...M,{schema_version:"1",favorite:!1,sql:"",content_id:"",...e}])},{showUpgradePrompt:W,setShowUpgradePrompt:H}=(0,b._)(I.iso_timestamp_start);(0,o.useEffect)(()=>{s&&J({mode:"custom",searchString:s})},[]),(0,o.useEffect)(()=>{let e=[],t=I.iso_timestamp_start?l()(I.iso_timestamp_start):l()(),s=I.iso_timestamp_end?l()(I.iso_timestamp_end):l()(),a=Math.abs(t.diff(s,"days"));L&&!L.includes("limit")&&a>h.$K&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),O(e)},[L,I.iso_timestamp_start,I.iso_timestamp_end]),(0,o.useEffect)(()=>{if(g){var e;(0,h.dP)(g,null==F?void 0:null===(e=F.plan)||void 0===e?void 0:e.id)&&H(!W)}},[g,F]);let J=t=>{z(t.searchString),G(t.searchString),T((0,C.k$)()),e.push({pathname:e.pathname,query:{...e.query,q:t.searchString}}),X({sql:t.searchString})},K=t=>{let s="string"==typeof t&&t||L;t&&"string"==typeof t&&z(t),G(s),V(),e.push({pathname:e.pathname,query:{...e.query,q:s}}),X({sql:s})};function B(){R(!Z)}let{isLoading:Y,mutate:ee}=(0,y.T)({onError:e=>{console.error(e),R(!1),c.ZP.error("Failed to save query: ".concat(e.message))},onSuccess:e=>{R(!1),c.ZP.success('Saved "'.concat(e[0].name,'" log query'))}});return(0,a.jsxs)("div",{className:"w-full h-full mx-auto",children:[(0,a.jsxs)(d.pO,{className:"w-full h-full",direction:"vertical",autoSaveId:q.dA.LOG_EXPLORER_SPLIT_SIZE,children:[(0,a.jsxs)(d.ee,{collapsible:!0,minSize:5,children:[(0,a.jsx)(h.dL,{defaultFrom:I.iso_timestamp_start||"",defaultTo:I.iso_timestamp_end||"",onDateChange:t=>{var s;let{to:a,from:i}=t;(0,h.dP)(i,null==F?void 0:null===(s=F.plan)||void 0===s?void 0:s.id)?H(!W):(A(e=>({...e,iso_timestamp_start:i||"",iso_timestamp_end:a||""})),e.push({pathname:e.pathname,query:{...e.query,its:i||"",ite:a||""}}))},onSelectSource:e=>{z(t=>{let s=t.indexOf("from");return -1===s?"".concat(t).concat(e):"".concat(t.substring(0,s+4)," ").concat(e," ").concat(t.substring(s+5))}),T((0,C.k$)())},onClear:()=>{z(""),T((0,C.k$)()),G("")},hasEditorValue:!!L,templates:h.xN.filter(e=>"custom"===e.mode),onSelectTemplate:J,onSave:B,isLoading:D,warnings:k}),(0,a.jsx)(_.Z,{active:D}),(0,a.jsx)(j.pq,{id:P,language:"pgsql",defaultValue:L,onInputChange:e=>z(e||""),onInputRun:K})]}),(0,a.jsx)(d.Dp,{withHandle:!0}),(0,a.jsxs)(d.ee,{collapsible:!0,minSize:5,className:"flex flex-col flex-grow",children:[(0,a.jsx)(v.Z,{active:D,children:(0,a.jsx)(h.ol,{onRun:K,onSave:B,hasEditorValue:!!L,params:I,data:$,error:U,projectRef:t})}),(0,a.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,a.jsx)(f.Z,{show:W,setShowUpgradePrompt:H})})]})]}),(0,a.jsx)(m.C,{size:"medium",onCancel:()=>R(!Z),header:"Save log query",visible:Z,hideFooter:!0,children:(0,a.jsx)(u.Z,{initialValues:{name:"",desdcription:""},onSubmit:async(e,s)=>{let{setSubmitting:a}=s;a(!0),ee({projectRef:t,payload:{id:(0,C.k$)(),name:e.name,description:e.description||"",type:"log_sql",content:{content_id:P,sql:L,schema_version:"1",favorite:!1},visibility:"user"}})},children:()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(m.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(p.Z,{layout:"horizontal",label:"Name",id:"name"}),(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(p.Z.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]})})}),(0,a.jsx)("div",{className:"py-3 border-t bg-surface-100",children:(0,a.jsx)(m.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(x.z,{size:"tiny",type:"default",onClick:()=>R(!Z),children:"Cancel"}),(0,a.jsx)(x.z,{size:"tiny",loading:Y,disabled:Y,htmlType:"submit",children:"Save"})]})})})]})})})]})};E.getLayout=e=>(0,a.jsx)(g.Uj,{children:e}),t.default=E}},function(e){e.O(0,[667,9678,8183,8421,3844,9785,7263,9818,9595,5191,7127,9104,6917,7990,4018,15,7309,9229,3832,8475,626,496,1273,8020,7298,3710,9774,2888,179],function(){return e(e.s=50893)}),_N_E=e.O()}]);